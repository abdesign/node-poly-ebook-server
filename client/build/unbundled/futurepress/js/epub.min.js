"use strict";(function(){function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function n(){}function o(e,t){for(var r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return-1}function i(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function s(e,t){return"onerror"===e?void Pe.on("error",t):2!==arguments.length?Pe[e]:void(Pe[e]=t)}function a(){setTimeout(function(){for(var e,t=0;t<Be.length;t++){e=Be[t];var r=e.payload;r.guid=r.key+r.id,r.childGuid=r.key+r.childId,r.error&&(r.stack=r.error.stack),Pe.trigger(e.name,e.payload)}Be.length=0},50)}function c(e,t,r){1===Be.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:r&&r._id,label:t._label,timeStamp:ve(),error:Pe["instrument-with-stack"]?new Error(t._label):null}})&&a()}function h(){return new TypeError("A promises callback cannot return that same promise.")}function p(){}function u(e){try{return e.then}catch(t){return xe.error=t,xe}}function l(e,t,r,n){try{e.call(t,r,n)}catch(o){return o}}function d(e,t,r){Pe.async(function(e){var n=!1,o=l(r,t,function(r){n||(n=!0,t!==r?m(e,r):v(e,r))},function(t){n||(n=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&o&&(n=!0,E(e,o))},e)}function f(e,t){t._state===Je?v(e,t._result):t._state===we?(t._onError=null,E(e,t._result)):S(t,void 0,function(r){t!==r?m(e,r):v(e,r)},function(t){E(e,t)})}function g(e,r){if(r.constructor===e.constructor)f(e,r);else{var n=u(r);n===xe?E(e,xe.error):void 0===n?v(e,r):t(n)?d(e,r,n):v(e,r)}}function m(t,r){t===r?v(t,r):e(r)?g(t,r):v(t,r)}function y(e){e._onError&&e._onError(e._result),P(e)}function v(e,t){e._state===be&&(e._result=t,e._state=Je,0===e._subscribers.length?Pe.instrument&&Ue("fulfilled",e):Pe.async(P,e))}function E(e,t){e._state===be&&(e._state=we,e._result=t,Pe.async(y,e))}function S(e,t,r,n){var o=e._subscribers,i=o.length;e._onError=null,o[i]=t,o[i+Je]=r,o[i+we]=n,0===i&&e._state&&Pe.async(P,e)}function P(e){var t=e._subscribers,r=e._state;if(Pe.instrument&&Ue(r===Je?"fulfilled":"rejected",e),0!==t.length){for(var n,o,i=e._result,s=0;s<t.length;s+=3)n=t[s],o=t[s+r],n?b(r,n,o,i):o(i);e._subscribers.length=0}}function B(){this.error=null}function U(e,t){try{return e(t)}catch(r){return Re.error=r,Re}}function b(e,r,n,o){var i,s,a,c,p=t(n);if(p){if(i=U(n,o),i===Re?(c=!0,s=i.error,i=null):a=!0,r===i)return void E(r,h())}else i=o,a=!0;r._state!==be||(p&&a?m(r,i):c?E(r,s):e===Je?v(r,i):e===we&&E(r,i))}function J(e,t){var r=!1;try{t(function(t){r||(r=!0,m(e,t))},function(t){r||(r=!0,E(e,t))})}catch(n){E(e,n)}}function w(e,t,r){return e===Je?{state:"fulfilled",value:r}:{state:"rejected",reason:r}}function x(e,t,r,n){var o=this;o._instanceConstructor=e,o.promise=new e(p,n),o._abortOnReject=r,o._validateInput(t)?(o._input=t,o.length=t.length,o._remaining=t.length,o._init(),0===o.length?v(o.promise,o._result):(o.length=o.length||0,o._enumerate(),0===o._remaining&&v(o.promise,o._result))):E(o.promise,o._validationError())}function R(e,t){return new Ce(this,e,(!0),t).promise}function C(e,t){function r(e){m(i,e)}function n(e){E(i,e)}var o=this,i=new o(p,t);if(!ye(e))return E(i,new TypeError("You must pass an array to race.")),i;for(var s=e.length,a=0;i._state===be&&s>a;a++)S(o.resolve(e[a]),void 0,r,n);return i}function k(e,t){var r=this;if(e&&"object"==typeof e&&e.constructor===r)return e;var n=new r(p,t);return m(n,e),n}function _(e,t){var r=this,n=new r(p,t);return E(n,e),n}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function T(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(e,r){var n=this;n._id=Ie++,n._label=r,n._state=void 0,n._result=void 0,n._subscribers=[],Pe.instrument&&Ue("created",n),p!==e&&(t(e)||L(),n instanceof N||T(),J(n,e))}function I(e,t,r){this._superConstructor(e,t,!1,r)}function F(e,t){return new I(Fe,e,t).promise}function O(e,t){return Fe.all(e,t)}function A(e,t){Ke[je]=e,Ke[je+1]=t,je+=2,2===je&&Ae()}function M(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){e(V)}}function q(){return function(){Oe(V)}}function j(){var e=0,t=new ze(V),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function W(){var e=new MessageChannel;return e.port1.onmessage=V,function(){e.port2.postMessage(0)}}function D(){return function(){setTimeout(V,1)}}function V(){for(var e=0;je>e;e+=2){var t=Ke[e],r=Ke[e+1];t(r),Ke[e]=void 0,Ke[e+1]=void 0}je=0}function z(){try{var e=require,t=e("vertx");return Oe=t.runOnLoop||t.runOnContext,q()}catch(r){return D()}}function H(e){var t={};return t.promise=new Fe(function(e,r){t.resolve=e,t.reject=r},e),t}function X(e,r,n){return Fe.all(e,n).then(function(e){if(!t(r))throw new TypeError("You must pass a function as filter's second argument.");for(var o=e.length,i=new Array(o),s=0;o>s;s++)i[s]=r(e[s]);return Fe.all(i,n).then(function(t){for(var r=new Array(o),n=0,i=0;o>i;i++)t[i]&&(r[n]=e[i],n++);return r.length=n,r})})}function K(e,t,r){this._superConstructor(e,t,!0,r)}function Q(e,t,r){this._superConstructor(e,t,!1,r)}function G(e,t){return new Q(Fe,e,t).promise}function Y(e,t){return new Ye(Fe,e,t).promise}function $(e,r,n){return Fe.all(e,n).then(function(e){if(!t(r))throw new TypeError("You must pass a function as map's second argument.");for(var o=e.length,i=new Array(o),s=0;o>s;s++)i[s]=r(e[s]);return Fe.all(i,n)})}function Z(){this.value=void 0}function ee(e){try{return e.then}catch(t){return rt.value=t,rt}}function te(e,t,r){try{e.apply(t,r)}catch(n){return rt.value=n,rt}}function re(e,t){for(var r,n,o={},i=e.length,s=new Array(i),a=0;i>a;a++)s[a]=e[a];for(n=0;n<t.length;n++)r=t[n],o[r]=s[n+1];return o}function ne(e){for(var t=e.length,r=new Array(t-1),n=1;t>n;n++)r[n-1]=e[n];return r}function oe(e,t){return{then:function(r,n){return e.call(t,r,n)}}}function ie(e,t){var r=function(){for(var r,n=this,o=arguments.length,i=new Array(o+1),s=!1,a=0;o>a;++a){if(r=arguments[a],!s){if(s=ce(r),s===nt){var c=new Fe(p);return E(c,nt.value),c}s&&s!==!0&&(r=oe(s,r))}i[a]=r}var h=new Fe(p);return i[o]=function(e,r){e?E(h,e):void 0===t?m(h,r):t===!0?m(h,ne(arguments)):ye(t)?m(h,re(arguments,t)):m(h,r)},s?ae(h,i,e,n):se(h,i,e,n)};return r.__proto__=e,r}function se(e,t,r,n){var o=te(r,n,t);return o===rt&&E(e,o.value),e}function ae(e,t,r,n){return Fe.all(t).then(function(t){var o=te(r,n,t);return o===rt&&E(e,o.value),e})}function ce(e){return!(!e||"object"!=typeof e)&&(e.constructor===Fe||ee(e))}function he(e,t){return Fe.race(e,t)}function pe(e,t){return Fe.reject(e,t)}function ue(e,t){return Fe.resolve(e,t)}function le(e){throw setTimeout(function(){throw e}),e}function de(e,t){Pe.async(e,t)}function fe(){Pe.on.apply(Pe,arguments)}function ge(){Pe.off.apply(Pe,arguments)}var me;me=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var ye=me,ve=Date.now||function(){return(new Date).getTime()},Ee=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return n.prototype=e,new n},Se={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){if("function"!=typeof t)throw new TypeError("Callback must be a function");var r,n=i(this);r=n[e],r||(r=n[e]=[]),-1===o(r,t)&&r.push(t)},off:function(e,t){var r,n,s=i(this);return t?(r=s[e],n=o(r,t),void(-1!==n&&r.splice(n,1))):void(s[e]=[])},trigger:function(e,t,r){var n,o,s=i(this);if(n=s[e])for(var a=0;a<n.length;a++)(o=n[a])(t,r)}},Pe={instrument:!1};Se.mixin(Pe);var Be=[],Ue=c,be=void 0,Je=1,we=2,xe=new B,Re=new B,Ce=x;x.prototype._validateInput=function(e){return ye(e)},x.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},x.prototype._init=function(){this._result=new Array(this.length)},x.prototype._enumerate=function(){for(var e=this,t=e.length,r=e.promise,n=e._input,o=0;r._state===be&&t>o;o++)e._eachEntry(n[o],o)},x.prototype._eachEntry=function(e,t){var n=this,o=n._instanceConstructor;r(e)?e.constructor===o&&e._state!==be?(e._onError=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(o.resolve(e),t):(n._remaining--,n._result[t]=n._makeResult(Je,t,e))},x.prototype._settledAt=function(e,t,r){var n=this,o=n.promise;o._state===be&&(n._remaining--,n._abortOnReject&&e===we?E(o,r):n._result[t]=n._makeResult(e,t,r)),0===n._remaining&&v(o,n._result)},x.prototype._makeResult=function(e,t,r){return r},x.prototype._willSettleAt=function(e,t){var r=this;S(e,void 0,function(e){r._settledAt(Je,t,e)},function(e){r._settledAt(we,t,e)})};var ke=R,_e=C,Le=k,Te=_,Ne="rsvp_"+ve()+"-",Ie=0,Fe=N;N.cast=Le,N.all=ke,N.race=_e,N.resolve=Le,N.reject=Te,N.prototype={constructor:N,_guidKey:Ne,_onError:function(e){var t=this;Pe.after(function(){t._onError&&Pe.trigger("error",e,t._label)})},then:function(e,t,r){var n=this,o=n._state;if(o===Je&&!e||o===we&&!t)return Pe.instrument&&Ue("chained",n,n),n;n._onError=null;var i=new n.constructor(p,r),s=n._result;if(Pe.instrument&&Ue("chained",n,i),o){var a=arguments[o-1];Pe.async(function(){b(o,i,a,s)})}else S(n,i,e,t);return i},"catch":function(e,t){return this.then(void 0,e,t)},"finally":function(e,t){var r=this,n=r.constructor;return r.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}},I.prototype=Ee(Ce.prototype),I.prototype._superConstructor=Ce,I.prototype._makeResult=w,I.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Oe,Ae,Me=F,qe=O,je=0,We=({}.toString,A),De="undefined"!=typeof window?window:void 0,Ve=De||{},ze=Ve.MutationObserver||Ve.WebKitMutationObserver,He="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Xe="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Ke=new Array(1e3);Ae=He?M():ze?j():Xe?W():void 0===De&&"function"==typeof require?z():D();var Qe=H,Ge=X,Ye=K;K.prototype=Ee(Ce.prototype),K.prototype._superConstructor=Ce,K.prototype._init=function(){this._result={}},K.prototype._validateInput=function(e){return e&&"object"==typeof e},K.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},K.prototype._enumerate=function(){var e=this,t=e.promise,r=e._input,n=[];for(var o in r)t._state===be&&Object.prototype.hasOwnProperty.call(r,o)&&n.push({position:o,entry:r[o]});var i=n.length;e._remaining=i;for(var s,a=0;t._state===be&&i>a;a++)s=n[a],e._eachEntry(s.entry,s.position)},Q.prototype=Ee(Ye.prototype),Q.prototype._superConstructor=Ce,Q.prototype._makeResult=w,Q.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var $e,Ze=G,et=Y,tt=$,rt=new Z,nt=new Z,ot=ie;if("object"==typeof self)$e=self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");$e=global}var it=$e,st=he,at=pe,ct=ue,ht=le;if(Pe.async=We,Pe.after=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var pt=window.__PROMISE_INSTRUMENTATION__;s("instrument",!0);for(var ut in pt)pt.hasOwnProperty(ut)&&fe(ut,pt[ut])}var lt={race:st,Promise:Fe,allSettled:Me,hash:et,hashSettled:Ze,denodeify:ot,on:fe,off:ge,map:tt,filter:Ge,resolve:ct,reject:at,all:qe,rethrow:ht,defer:Qe,EventTarget:Se,configure:s,async:de};"function"==typeof define&&define.amd?define(function(){return lt}):"undefined"!=typeof module&&module.exports?module.exports=lt:"undefined"!=typeof it&&(it.RSVP=lt)}).call(this);var EPUBJS=EPUBJS||{};EPUBJS.VERSION="0.2.13",EPUBJS.plugins=EPUBJS.plugins||{},EPUBJS.filePath=EPUBJS.filePath||"/epubjs/",EPUBJS.Render={},function(e){var t=(e.ePub||{},e.ePub=function(){var e,t;return"undefined"!=typeof arguments[0]&&("string"==typeof arguments[0]||arguments[0]instanceof ArrayBuffer)&&(e=arguments[0],arguments[1]&&"object"==typeof arguments[1]?(t=arguments[1],t.bookPath=e):t={bookPath:e}),!arguments[0]||"object"!=typeof arguments[0]||arguments[0]instanceof ArrayBuffer||(t=arguments[0]),new EPUBJS.Book(t)});"function"==typeof define&&define.amd?define(["rsvp"],function(){return t}):"undefined"!=typeof module&&module.exports&&(module.exports=t)}(window),EPUBJS.Book=function(e){this.settings=EPUBJS.core.defaults(e||{},{bookPath:void 0,bookKey:void 0,packageUrl:void 0,storage:!1,fromStorage:!1,saved:!1,online:!0,contained:!1,width:void 0,height:void 0,layoutOveride:void 0,orientation:void 0,minSpreadWidth:768,gap:"auto",version:1,restore:!1,reload:!1,"goto":!1,styles:{},headTags:{},withCredentials:!1,render_method:"Iframe"}),this.settings.EPUBJSVERSION=EPUBJS.VERSION,this.spinePos=0,this.stored=!1,this.online=this.settings.online||navigator.onLine,this.networkListeners(),this.ready={manifest:new RSVP.defer,spine:new RSVP.defer,metadata:new RSVP.defer,cover:new RSVP.defer,toc:new RSVP.defer,pageList:new RSVP.defer},this.readyPromises=[this.ready.manifest.promise,this.ready.spine.promise,this.ready.metadata.promise,this.ready.cover.promise,this.ready.toc.promise],this.pageList=[],this.pagination=new EPUBJS.Pagination,this.pageListReady=this.ready.pageList.promise,this.ready.all=RSVP.all(this.readyPromises),this.ready.all.then(this._ready.bind(this)),this.isRendered=!1,this._q=EPUBJS.core.queue(this),this._rendering=!1,this._displayQ=EPUBJS.core.queue(this),this._moving=!1,this._gotoQ=EPUBJS.core.queue(this),this.renderer=new EPUBJS.Renderer(this.settings.render_method),this.renderer.setMinSpreadWidth(this.settings.minSpreadWidth),this.renderer.setGap(this.settings.gap),this.listenToRenderer(this.renderer),this.defer_opened=new RSVP.defer,this.opened=this.defer_opened.promise,this.store=!1,this.settings.storage!==!1&&this.fromStorage(!0),("string"==typeof this.settings.bookPath||this.settings.bookPath instanceof ArrayBuffer)&&this.open(this.settings.bookPath,this.settings.reload),window.addEventListener("beforeunload",this.unload.bind(this),!1)},EPUBJS.Book.prototype.open=function(e,t){var r,n=this,o=new RSVP.defer;return this.settings.bookPath=e,this.settings.contained||this.isContained(e)?(this.settings.contained=this.contained=!0,this.bookUrl="",r=this.unarchive(e).then(function(){return n.loadPackage()})):(this.bookUrl=this.urlFrom(e),r=this.loadPackage()),r.then(this.settings.restore&&!t&&localStorage?function(e){var t=n.packageIdentifier(e),r=n.restore(t);r||n.unpack(e),o.resolve(),n.defer_opened.resolve()}:function(e){n.unpack(e),o.resolve(),n.defer_opened.resolve()}),this._registerReplacements(this.renderer),o.promise},EPUBJS.Book.prototype.loadPackage=function(e){var t,r=this,n=new EPUBJS.Parser,o=e||"META-INF/container.xml";return t=this.settings.packageUrl?r.loadXml(r.settings.packageUrl):r.loadXml(r.bookUrl+o).then(function(e){return n.container(e)}).then(function(e){return r.settings.contentsPath=r.bookUrl+e.basePath,r.settings.packageUrl=r.bookUrl+e.packagePath,r.settings.encoding=e.encoding,r.loadXml(r.settings.packageUrl)}),t["catch"](function(){console.error("Could not load book at: "+o),r.trigger("book:loadFailed",o)}),t},EPUBJS.Book.prototype.packageIdentifier=function(e){var t=new EPUBJS.Parser;return t.identifier(e)},EPUBJS.Book.prototype.unpack=function(e){var t=this,r=new EPUBJS.Parser;t.contents=r.packageContents(e,t.settings.contentsPath),t.manifest=t.contents.manifest,t.spine=t.contents.spine,t.spineIndexByURL=t.contents.spineIndexByURL,t.metadata=t.contents.metadata,t.settings.bookKey||(t.settings.bookKey=t.generateBookKey(t.metadata.identifier)),t.globalLayoutProperties=t.parseLayoutProperties(t.metadata),t.contents.coverPath&&(t.cover=t.contents.cover=t.settings.contentsPath+t.contents.coverPath),t.spineNodeIndex=t.contents.spineNodeIndex,t.ready.manifest.resolve(t.contents.manifest),t.ready.spine.resolve(t.contents.spine),t.ready.metadata.resolve(t.contents.metadata),t.ready.cover.resolve(t.contents.cover),t.locations=new EPUBJS.Locations(t.spine,t.store,t.settings.withCredentials),t.contents.navPath?(t.settings.navUrl=t.settings.contentsPath+t.contents.navPath,t.loadXml(t.settings.navUrl).then(function(e){return r.nav(e,t.spineIndexByURL,t.spine)}).then(function(e){t.toc=t.contents.toc=e,t.ready.toc.resolve(t.contents.toc)},function(){t.ready.toc.resolve(!1)}),t.loadXml(t.settings.navUrl).then(function(e){return r.pageList(e,t.spineIndexByURL,t.spine)}).then(function(e){var r=new EPUBJS.EpubCFI,n=0;0!==e.length&&(t.pageList=t.contents.pageList=e,t.pageList.forEach(function(e){e.cfi||(n+=1,r.generateCfiFromHref(e.href,t).then(function(r){e.cfi=r,e.packageUrl=t.settings.packageUrl,n-=1,0===n&&(t.pagination.process(t.pageList),t.ready.pageList.resolve(t.pageList))}))}),n||(t.pagination.process(t.pageList),t.ready.pageList.resolve(t.pageList)))},function(){t.ready.pageList.resolve([])})):t.contents.tocPath?(t.settings.tocUrl=t.settings.contentsPath+t.contents.tocPath,t.loadXml(t.settings.tocUrl).then(function(e){return r.toc(e,t.spineIndexByURL,t.spine)},function(e){console.error(e)}).then(function(e){t.toc=t.contents.toc=e,t.ready.toc.resolve(t.contents.toc)},function(){t.ready.toc.resolve(!1)})):t.ready.toc.resolve(!1)},EPUBJS.Book.prototype.createHiddenRender=function(e,t,r){var n,o,i=this.element.getBoundingClientRect(),s=t||this.settings.width||i.width,a=r||this.settings.height||i.height;return e.setMinSpreadWidth(this.settings.minSpreadWidth),e.setGap(this.settings.gap),this._registerReplacements(e),this.settings.forceSingle&&e.forceSingle(!0),n=document.createElement("div"),n.style.visibility="hidden",n.style.overflow="hidden",n.style.width="0",n.style.height="0",this.element.appendChild(n),o=document.createElement("div"),o.style.visibility="hidden",o.style.overflow="hidden",o.style.width=s+"px",o.style.height=a+"px",n.appendChild(o),e.initialize(o),n},EPUBJS.Book.prototype.generatePageList=function(e,t){var r=[],n=new EPUBJS.Renderer(this.settings.render_method,(!1)),o=this.createHiddenRender(n,e,t),i=new RSVP.defer,s=-1,a=this.spine.length,c=0,h=function(e){var t,o=s+1,i=e||new RSVP.defer;return o>=a?i.resolve():(s=o,t=new EPUBJS.Chapter(this.spine[s],this.store),n.displayChapter(t,this.globalLayoutProperties).then(function(){n.pageMap.forEach(function(e){c+=1,r.push({cfi:e.start,page:c})}),n.pageMap.length%2>0&&n.spreads&&(c+=1,r.push({cfi:n.pageMap[n.pageMap.length-1].end,page:c})),setTimeout(function(){h(i)},1)})),i.promise}.bind(this);return h().then(function(){n.remove(),this.element.removeChild(o),i.resolve(r)}.bind(this)),i.promise},EPUBJS.Book.prototype.generatePagination=function(e,t){var r=this,n=new RSVP.defer;return this.ready.spine.promise.then(function(){r.generatePageList(e,t).then(function(e){r.pageList=r.contents.pageList=e,r.pagination.process(e),r.ready.pageList.resolve(r.pageList),n.resolve(r.pageList)})}),n.promise},EPUBJS.Book.prototype.loadPagination=function(e){var t=JSON.parse(e);return t&&t.length&&(this.pageList=t,this.pagination.process(this.pageList),this.ready.pageList.resolve(this.pageList)),this.pageList},EPUBJS.Book.prototype.getPageList=function(){return this.ready.pageList.promise},EPUBJS.Book.prototype.getMetadata=function(){return this.ready.metadata.promise},EPUBJS.Book.prototype.getToc=function(){return this.ready.toc.promise},EPUBJS.Book.prototype.networkListeners=function(){var e=this;window.addEventListener("offline",function(){e.online=!1,e.settings.storage&&e.fromStorage(!0),e.trigger("book:offline")},!1),window.addEventListener("online",function(){e.online=!0,e.settings.storage&&e.fromStorage(!1),e.trigger("book:online")},!1)},EPUBJS.Book.prototype.listenToRenderer=function(e){var t=this;e.Events.forEach(function(r){e.on(r,function(e){t.trigger(r,e)})}),e.on("renderer:visibleRangeChanged",function(e){var t,r,n,o=[];this.pageList.length>0&&(t=this.pagination.pageFromCfi(e.start),n=this.pagination.percentageFromPage(t),o.push(t),e.end&&(r=this.pagination.pageFromCfi(e.end),o.push(r)),this.trigger("book:pageChanged",{anchorPage:t,percentage:n,pageRange:o}))}.bind(this)),e.on("render:loaded",this.loadChange.bind(this))},EPUBJS.Book.prototype.loadChange=function(e){var t,r,n=EPUBJS.core.uri(e),o=EPUBJS.core.uri(this.currentChapter.absolute);n.path!=o.path?(console.warn("Miss Match",n.path,this.currentChapter.absolute),t=this.spineIndexByURL[n.filename],r=new EPUBJS.Chapter(this.spine[t],this.store),this.currentChapter=r,this.renderer.currentChapter=r,this.renderer.afterLoad(this.renderer.render.docEl),this.renderer.beforeDisplay(function(){this.renderer.afterDisplay()}.bind(this))):this._rendering||this.renderer.reformat()},EPUBJS.Book.prototype.unlistenToRenderer=function(e){e.Events.forEach(function(t){e.off(t)})},EPUBJS.Book.prototype.coverUrl=function(){var e=this.ready.cover.promise.then(function(){return this.settings.fromStorage?this.store.getUrl(this.contents.cover):this.settings.contained?this.zip.getUrl(this.contents.cover):this.contents.cover}.bind(this));return e.then(function(e){this.cover=e}.bind(this)),e},EPUBJS.Book.prototype.loadXml=function(e){return this.settings.fromStorage?this.store.getXml(e,this.settings.encoding):this.settings.contained?this.zip.getXml(e,this.settings.encoding):EPUBJS.core.request(e,"xml",this.settings.withCredentials)},EPUBJS.Book.prototype.urlFrom=function(e){var t,r=EPUBJS.core.uri(e),n=r.protocol,o="/"==r.path[0],i=window.location,s=i.origin||i.protocol+"//"+i.host,a=document.getElementsByTagName("base");return a.length&&(t=a[0].href),r.protocol?r.origin+r.path:!n&&o?(t||s)+r.path:n||o?void 0:EPUBJS.core.resolveUrl(t||i.pathname,r.path)},EPUBJS.Book.prototype.unarchive=function(e){return this.zip=new EPUBJS.Unarchiver,this.store=this.zip,this.zip.open(e)},EPUBJS.Book.prototype.isContained=function(e){if(e instanceof ArrayBuffer)return!0;var t=EPUBJS.core.uri(e);return!(!t.extension||"epub"!=t.extension&&"zip"!=t.extension)},EPUBJS.Book.prototype.isSaved=function(e){var t;return!!localStorage&&(t=localStorage.getItem(e),!(!localStorage||null===t))},EPUBJS.Book.prototype.generateBookKey=function(e){return"epubjs:"+EPUBJS.VERSION+":"+window.location.host+":"+e},EPUBJS.Book.prototype.saveContents=function(){return!!localStorage&&void localStorage.setItem(this.settings.bookKey,JSON.stringify(this.contents))},EPUBJS.Book.prototype.removeSavedContents=function(){return!!localStorage&&void localStorage.removeItem(this.settings.bookKey)},EPUBJS.Book.prototype.renderTo=function(e){var t,r=this;if(EPUBJS.core.isElement(e))this.element=e;else{if("string"!=typeof e)return void console.error("Not an Element");this.element=EPUBJS.core.getEl(e)}return t=this.opened.then(function(){return r.renderer.initialize(r.element,r.settings.width,r.settings.height),r.metadata.direction&&r.renderer.setDirection(r.metadata.direction),r._rendered(),r.startDisplay()})},EPUBJS.Book.prototype.startDisplay=function(){var e;return e=this.settings["goto"]?this["goto"](this.settings["goto"]):this.settings.previousLocationCfi?this.gotoCfi(this.settings.previousLocationCfi):this.displayChapter(this.spinePos)},EPUBJS.Book.prototype.restore=function(e){var t,r=this,n=["manifest","spine","metadata","cover","toc","spineNodeIndex","spineIndexByURL","globalLayoutProperties"],o=!1,i=this.generateBookKey(e),s=localStorage.getItem(i),a=n.length;if(this.settings.clearSaved&&(o=!0),!o&&"undefined"!=s&&null!==s)for(r.contents=JSON.parse(s),t=0;a>t;t++){var c=n[t];if(!r.contents[c]){o=!0;break}r[c]=r.contents[c]}return!(o||!s||!this.contents||!this.settings.contentsPath)&&(this.settings.bookKey=i,this.ready.manifest.resolve(this.manifest),this.ready.spine.resolve(this.spine),this.ready.metadata.resolve(this.metadata),this.ready.cover.resolve(this.cover),this.ready.toc.resolve(this.toc),!0)},EPUBJS.Book.prototype.displayChapter=function(e,t,r){var n,o,i,s,a=this,c=r||new RSVP.defer;return this.isRendered?this._rendering||this._rendering?(this._displayQ.enqueue("displayChapter",[e,t,c]),c.promise):(EPUBJS.core.isNumber(e)?i=e:(o=new EPUBJS.EpubCFI(e),i=o.spinePos),(0>i||i>=this.spine.length)&&(console.warn("Not A Valid Location"),i=0,t=!1,o=!1),s=new EPUBJS.Chapter(this.spine[i],this.store),this._rendering=!0,this._needsAssetReplacement()&&s.registerHook("beforeChapterRender",[EPUBJS.replace.head,EPUBJS.replace.resources,EPUBJS.replace.svg],!0),a.currentChapter=s,n=a.renderer.displayChapter(s,this.globalLayoutProperties),o?a.renderer.gotoCfi(o):t&&a.renderer.lastPage(),n.then(function(){a.spinePos=i,c.resolve(a.renderer),a.settings.fromStorage===!1&&a.settings.contained===!1&&a.preloadNextChapter(),a._rendering=!1,a._displayQ.dequeue(),0===a._displayQ.length()&&a._gotoQ.dequeue()},function(e){console.error("Could not load Chapter: "+s.absolute,e),a.trigger("book:chapterLoadFailed",s.absolute),a._rendering=!1,c.reject(e)}),c.promise):(this._q.enqueue("displayChapter",arguments),c.reject({message:"Rendering",stack:(new Error).stack}),c.promise)},EPUBJS.Book.prototype.nextPage=function(){var e;return this.isRendered?(e=this.renderer.nextPage(),e?void 0:this.nextChapter()):this._q.enqueue("nextPage",arguments)},EPUBJS.Book.prototype.prevPage=function(){var e;return this.isRendered?(e=this.renderer.prevPage(),e?void 0:this.prevChapter()):this._q.enqueue("prevPage",arguments)},EPUBJS.Book.prototype.nextChapter=function(){var e;if(this.spinePos<this.spine.length-1){for(e=this.spinePos+1;this.spine[e]&&this.spine[e].linear&&"no"==this.spine[e].linear;)e++;if(e<this.spine.length)return this.displayChapter(e);this.trigger("book:atEnd")}else this.trigger("book:atEnd")},EPUBJS.Book.prototype.prevChapter=function(){var e;if(this.spinePos>0){for(e=this.spinePos-1;this.spine[e]&&this.spine[e].linear&&"no"==this.spine[e].linear;)e--;if(e>=0)return this.displayChapter(e,!0);this.trigger("book:atStart")}else this.trigger("book:atStart")},EPUBJS.Book.prototype.getCurrentLocationCfi=function(){return!!this.isRendered&&this.renderer.currentLocationCfi},EPUBJS.Book.prototype["goto"]=function(e){return 0===e.indexOf("epubcfi(")?this.gotoCfi(e):e.indexOf("%")===e.length-1?this.gotoPercentage(parseInt(e.substring(0,e.length-1))/100):"number"==typeof e||isNaN(e)===!1?this.gotoPage(e):this.gotoHref(e)},EPUBJS.Book.prototype.gotoCfi=function(e,t){var r,n,o,i,s,a=t||new RSVP.defer;return this.isRendered?this._moving||this._rendering?(console.warn("Renderer is moving"),this._gotoQ.enqueue("gotoCfi",[e,a]),!1):(r=new EPUBJS.EpubCFI(e),n=r.spinePos,-1!=n&&(o=this.spine[n],i=a.promise,this._moving=!0,this.currentChapter&&this.spinePos===n?(this.renderer.gotoCfi(r),this._moving=!1,a.resolve(this.renderer.currentLocationCfi)):(o&&-1!=n||(n=0,o=this.spine[n]),s=this.displayChapter(e),s.then(function(e){this._moving=!1,a.resolve(e.currentLocationCfi)}.bind(this))),i.then(function(){this._gotoQ.dequeue()}.bind(this)),i)):(console.warn("Not yet Rendered"),this.settings.previousLocationCfi=e,!1)},EPUBJS.Book.prototype.gotoHref=function(e,t){var r,n,o,i,s,a=t||new RSVP.defer;return this.isRendered?this._moving||this._rendering?(this._gotoQ.enqueue("gotoHref",[e,a]),!1):(r=e.split("#"),n=r[0],o=r[1]||!1,i=-1==n.search("://")?n.replace(EPUBJS.core.uri(this.settings.contentsPath).path,""):n.replace(this.settings.contentsPath,""),s=this.spineIndexByURL[i],n||(s=this.currentChapter?this.currentChapter.spinePos:0),"number"==typeof s&&(this.currentChapter&&s==this.currentChapter.spinePos?(o?this.renderer.section(o):this.renderer.firstPage(),a.resolve(this.renderer.currentLocationCfi),a.promise.then(function(){this._gotoQ.dequeue()}.bind(this)),a.promise):this.displayChapter(s).then(function(){o&&this.renderer.section(o),a.resolve(this.renderer.currentLocationCfi)}.bind(this)))):(this.settings["goto"]=e,!1)},EPUBJS.Book.prototype.gotoPage=function(e){var t=this.pagination.cfiFromPage(e);return this.gotoCfi(t)},EPUBJS.Book.prototype.gotoPercentage=function(e){var t=this.pagination.pageFromPercentage(e);return this.gotoPage(t)},EPUBJS.Book.prototype.preloadNextChapter=function(){var e,t=this.spinePos+1;return!(t>=this.spine.length)&&(e=new EPUBJS.Chapter(this.spine[t]),void(e&&EPUBJS.core.request(e.absolute)))},EPUBJS.Book.prototype.storeOffline=function(){var e=this,t=EPUBJS.core.values(this.manifest);return this.store.put(t).then(function(){e.settings.stored=!0,e.trigger("book:stored")})},EPUBJS.Book.prototype.availableOffline=function(){return this.settings.stored>0},EPUBJS.Book.prototype.toStorage=function(){var e=this.settings.bookKey;this.store.isStored(e).then(function(t){return t===!0?(this.settings.stored=!0,!0):this.storeOffline().then(function(){this.store.token(e,!0)}.bind(this))}.bind(this))},EPUBJS.Book.prototype.fromStorage=function(e){[EPUBJS.replace.head,EPUBJS.replace.resources,EPUBJS.replace.svg],this.contained||this.settings.contained||(this.online&&this.opened.then(this.toStorage.bind(this)),this.store&&this.settings.fromStorage&&e===!1?(this.settings.fromStorage=!1,this.store.off("offline"),this.store=!1):this.settings.fromStorage||(this.store=new EPUBJS.Storage(this.settings.credentials),this.store.on("offline",function(e){e?(this.offline=!0,this.settings.fromStorage=!0,this.trigger("book:offline")):(this.offline=!1,this.settings.fromStorage=!1,this.trigger("book:online"))}.bind(this))))},EPUBJS.Book.prototype.setStyle=function(e,t,r){var n=["color","background","background-color"];return this.isRendered?(this.settings.styles[e]=t,this.renderer.setStyle(e,t,r),void(-1===n.indexOf(e)&&this.renderer.reformat())):this._q.enqueue("setStyle",arguments)},EPUBJS.Book.prototype.removeStyle=function(e){return this.isRendered?(this.renderer.removeStyle(e),this.renderer.reformat(),void delete this.settings.styles[e]):this._q.enqueue("removeStyle",arguments)},EPUBJS.Book.prototype.addHeadTag=function(e,t){return this.isRendered?void(this.settings.headTags[e]=t):this._q.enqueue("addHeadTag",arguments)},EPUBJS.Book.prototype.useSpreads=function(e){console.warn("useSpreads is deprecated, use forceSingle or set a layoutOveride instead"),this.forceSingle(e===!1)},EPUBJS.Book.prototype.forceSingle=function(e){var t="undefined"==typeof e||e;this.renderer.forceSingle(t),this.settings.forceSingle=t,this.isRendered&&this.renderer.reformat()},EPUBJS.Book.prototype.setMinSpreadWidth=function(e){this.settings.minSpreadWidth=e,this.isRendered&&(this.renderer.setMinSpreadWidth(this.settings.minSpreadWidth),this.renderer.reformat())},EPUBJS.Book.prototype.setGap=function(e){this.settings.gap=e,this.isRendered&&(this.renderer.setGap(this.settings.gap),this.renderer.reformat())},EPUBJS.Book.prototype.chapter=function(e){var t,r,n=this.spineIndexByURL[e];return n&&(t=this.spine[n],r=new EPUBJS.Chapter(t,this.store,this.settings.withCredentials),r.load()),r},EPUBJS.Book.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveContents(),this.unlistenToRenderer(this.renderer),this.trigger("book:unload")},EPUBJS.Book.prototype.destroy=function(){window.removeEventListener("beforeunload",this.unload),this.currentChapter&&this.currentChapter.unload(),this.unload(),this.renderer&&this.renderer.remove()},EPUBJS.Book.prototype._ready=function(){this.trigger("book:ready")},EPUBJS.Book.prototype._rendered=function(){this.isRendered=!0,this.trigger("book:rendered"),this._q.flush()},EPUBJS.Book.prototype.applyStyles=function(e,t){e.applyStyles(this.settings.styles),t()},EPUBJS.Book.prototype.applyHeadTags=function(e,t){e.applyHeadTags(this.settings.headTags),t()},EPUBJS.Book.prototype._registerReplacements=function(e){e.registerHook("beforeChapterDisplay",this.applyStyles.bind(this,e),!0),e.registerHook("beforeChapterDisplay",this.applyHeadTags.bind(this,e),!0),e.registerHook("beforeChapterDisplay",EPUBJS.replace.hrefs.bind(this),!0);
},EPUBJS.Book.prototype._needsAssetReplacement=function(){return!!this.settings.fromStorage||!!this.settings.contained},EPUBJS.Book.prototype.parseLayoutProperties=function(e){var t=this.settings.layoutOveride&&this.settings.layoutOveride.layout||e.layout||"reflowable",r=this.settings.layoutOveride&&this.settings.layoutOveride.spread||e.spread||"auto",n=this.settings.layoutOveride&&this.settings.layoutOveride.orientation||e.orientation||"auto";return{layout:t,spread:r,orientation:n}},RSVP.EventTarget.mixin(EPUBJS.Book.prototype),RSVP.on("error",function(e){console.error(e)}),EPUBJS.Chapter=function(e,t,r){this.href=e.href,this.absolute=e.url,this.id=e.id,this.spinePos=e.index,this.cfiBase=e.cfiBase,this.properties=e.properties,this.manifestProperties=e.manifestProperties,this.linear=e.linear,this.pages=1,this.store=t,this.credentials=r,this.epubcfi=new EPUBJS.EpubCFI,this.deferred=new RSVP.defer,this.loaded=this.deferred.promise,EPUBJS.Hooks.mixin(this),this.getHooks("beforeChapterRender"),this.caches={}},EPUBJS.Chapter.prototype.load=function(e,t){var r,n=e||this.store,o=t||this.credentials;return r=n?n.getXml(this.absolute):EPUBJS.core.request(this.absolute,!1,o),r.then(function(e){this.setDocument(e),this.deferred.resolve(this)}.bind(this)),r},EPUBJS.Chapter.prototype.render=function(){return this.load().then(function(e){var t=e.querySelector("head"),r=e.createElement("base");return r.setAttribute("href",this.absolute),t.insertBefore(r,t.firstChild),this.contents=e,new RSVP.Promise(function(t){this.triggerHooks("beforeChapterRender",function(){t(e)}.bind(this),this)}.bind(this))}.bind(this)).then(function(e){var t=new XMLSerializer,r=t.serializeToString(e);return r}.bind(this))},EPUBJS.Chapter.prototype.url=function(e){var t,r=new RSVP.defer,n=e||this.store,o=this;return n?this.tempUrl?(t=this.tempUrl,r.resolve(t)):n.getUrl(this.absolute).then(function(e){o.tempUrl=e,r.resolve(e)}):(t=this.absolute,r.resolve(t)),r.promise},EPUBJS.Chapter.prototype.setPages=function(e){this.pages=e},EPUBJS.Chapter.prototype.getPages=function(){return this.pages},EPUBJS.Chapter.prototype.getID=function(){return this.ID},EPUBJS.Chapter.prototype.unload=function(e){this.document=null,this.tempUrl&&e&&(e.revokeUrl(this.tempUrl),this.tempUrl=!1)},EPUBJS.Chapter.prototype.setDocument=function(e){var t=e.namespaceURI;e.doctype,this.document=e.implementation.createDocument(t,null,null),this.contents=this.document.importNode(e.documentElement,!0),this.document.appendChild(this.contents),!this.document.evaluate&&document.evaluate&&(this.document.evaluate=document.evaluate)},EPUBJS.Chapter.prototype.cfiFromRange=function(e){var t,r,n,o,i,s;if(this.document){if("undefined"!=typeof document.evaluate){if(r=EPUBJS.core.getElementXPath(e.startContainer),n=EPUBJS.core.getElementXPath(e.endContainer),o=this.document.evaluate(r,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,e.collapsed||(i=this.document.evaluate(n,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),t=this.document.createRange(),o)try{t.setStart(o,e.startOffset),!e.collapsed&&i&&t.setEnd(i,e.endOffset)}catch(a){console.log("missed"),o=!1}o||(console.log("not found, try fuzzy match"),cleanStartTextContent=EPUBJS.core.cleanStringForXpath(e.startContainer.textContent),r="//text()[contains(.,"+cleanStartTextContent+")]",o=this.document.evaluate(r,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,o&&(t.setStart(o,e.startOffset),e.collapsed||(s=EPUBJS.core.cleanStringForXpath(e.endContainer.textContent),n="//text()[contains(.,"+s+")]",i=this.document.evaluate(n,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,i&&t.setEnd(i,e.endOffset))))}else t=e;return this.epubcfi.generateCfiFromRange(t,this.cfiBase)}},EPUBJS.Chapter.prototype.find=function(e){var t=this,r=[],n=e.toLowerCase(),o=function(e){for(var o,i,s,a=e.textContent.toLowerCase(),c=t.document.createRange(),h=-1,p=150;-1!=i;)i=a.indexOf(n,h+1),-1!=i&&(c=t.document.createRange(),c.setStart(e,i),c.setEnd(e,i+n.length),o=t.cfiFromRange(c),e.textContent.length<p?s=e.textContent:(s=e.textContent.substring(i-p/2,i+p/2),s="..."+s+"..."),r.push({cfi:o,excerpt:s})),h=i};return this.textSprint(this.document,function(e){o(e)}),r},EPUBJS.Chapter.prototype.textSprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.data&&!/^\s*$/.test(e.data)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);r=n.nextNode();)t(r)},EPUBJS.Chapter.prototype.replace=function(e,t,r,n){var o=this.contents.querySelectorAll(e),i=Array.prototype.slice.call(o),s=i.length;return 0===s?void r(!1):void i.forEach(function(e){var o=!1,i=function(e,t){o===!1&&(s--,n&&n(e,t,s),0>=s&&r&&r(!0),o=!0)};t(e,i)}.bind(this))},EPUBJS.Chapter.prototype.replaceWithStored=function(e,t,r,n){var o,i={},s=this.store,a=this.caches[e],c=EPUBJS.core.uri(this.absolute),h=c.base,p=t,u=5,l=function(e,t){i[t]=e},d=function(){n&&n(),EPUBJS.core.values(o).forEach(function(e){s.revokeUrl(e)}),a=i};s&&(a||(a={}),o=EPUBJS.core.clone(a),this.replace(e,function(t,n){var a=t.getAttribute(p),c=EPUBJS.core.resolveUrl(h,a),l=function(r){var o;t.onload=function(){clearTimeout(o),n(r,c)},t.onerror=function(e){clearTimeout(o),n(r,c),console.error(e)},"svg image"==e&&t.setAttribute("externalResourcesRequired","true"),"link[href]"==e&&"stylesheet"!==t.getAttribute("rel")?n(r,c):o=setTimeout(function(){n(r,c)},u),r&&t.setAttribute(p,r)};c in o?(l(o[c]),i[c]=o[c],delete o[c]):r(s,c,l,t)},d,l))};var EPUBJS=EPUBJS||{};EPUBJS.core={},EPUBJS.core.getEl=function(e){return document.getElementById(e)},EPUBJS.core.getEls=function(e){return document.getElementsByClassName(e)},EPUBJS.core.request=function(e,t,r){var n,o=window.URL,i=o?"blob":"arraybuffer",s=new RSVP.defer,a=new XMLHttpRequest,c=XMLHttpRequest.prototype,h=function(){var e;this.readyState==this.DONE&&(200===this.status||0===this.status&&this.response?(e="xml"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xml"):"xhtml"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xhtml+xml"):"html"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"text/html"):"json"==t?JSON.parse(this.response):"blob"==t?o?this.response:new Blob([this.response]):this.response,s.resolve(e)):s.reject({message:this.response,stack:(new Error).stack}))};return"overrideMimeType"in c||Object.defineProperty(c,"overrideMimeType",{value:function(){}}),a.open("GET",e,!0),a.onreadystatechange=h,r&&(a.withCredentials=!0),t||(n=EPUBJS.core.uri(e),t=n.extension,t={htm:"html"}[t]||t),"blob"==t&&(a.responseType=i),"json"==t&&a.setRequestHeader("Accept","application/json"),"xml"==t&&(a.responseType="document",a.overrideMimeType("text/xml")),"xhtml"==t&&(a.responseType="document"),"html"==t&&(a.responseType="document"),"binary"==t&&(a.responseType="arraybuffer"),a.send(),s.promise},EPUBJS.core.toArray=function(e){var t=[];for(var r in e){var n;e.hasOwnProperty(r)&&(n=e[r],n.ident=r,t.push(n))}return t},EPUBJS.core.uri=function(e){var t,r,n,o={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:e},i=e.indexOf("blob:"),s=e.indexOf("://"),a=e.indexOf("?"),c=e.indexOf("#");return 0===i?(o.protocol="blob",o.base=e.indexOf(0,c),o):(-1!=c&&(o.fragment=e.slice(c+1),e=e.slice(0,c)),-1!=a&&(o.search=e.slice(a+1),e=e.slice(0,a),href=e),-1!=s?(o.protocol=e.slice(0,s),t=e.slice(s+3),n=t.indexOf("/"),-1===n?(o.host=o.path,o.path=""):(o.host=t.slice(0,n),o.path=t.slice(n)),o.origin=o.protocol+"://"+o.host,o.directory=EPUBJS.core.folder(o.path),o.base=o.origin+o.directory):(o.path=e,o.directory=EPUBJS.core.folder(e),o.base=o.directory),o.filename=e.replace(o.base,""),r=o.filename.lastIndexOf("."),-1!=r&&(o.extension=o.filename.slice(r+1)),o)},EPUBJS.core.folder=function(e){var t=e.lastIndexOf("/");if(-1==t)var r="";return r=e.slice(0,t+1)},EPUBJS.core.dataURLToBlob=function(e){var t,r,n,o,i,s=";base64,";if(-1==e.indexOf(s))return t=e.split(","),r=t[0].split(":")[1],n=t[1],new Blob([n],{type:r});t=e.split(s),r=t[0].split(":")[1],n=window.atob(t[1]),o=n.length,i=new Uint8Array(o);for(var a=0;o>a;++a)i[a]=n.charCodeAt(a);return new Blob([i],{type:r})},EPUBJS.core.addScript=function(e,t,r){var n,o;o=!1,n=document.createElement("script"),n.type="text/javascript",n.async=!1,n.src=e,n.onload=n.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,t&&t())},r=r||document.body,r.appendChild(n)},EPUBJS.core.addScripts=function(e,t,r){var n=e.length,o=0,i=function(){o++,n==o?t&&t():EPUBJS.core.addScript(e[o],i,r)};EPUBJS.core.addScript(e[o],i,r)},EPUBJS.core.addCss=function(e,t,r){var n,o;o=!1,n=document.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=e,n.onload=n.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,t&&t())},r=r||document.body,r.appendChild(n)},EPUBJS.core.prefixed=function(e){var t=["Webkit","Moz","O","ms"],r=e[0].toUpperCase()+e.slice(1),n=t.length;if("undefined"!=typeof document.documentElement.style[e])return e;for(var o=0;n>o;o++)if("undefined"!=typeof document.documentElement.style[t[o]+r])return t[o]+r;return e},EPUBJS.core.resolveUrl=function(e,t){var r,n,o=[],i=EPUBJS.core.uri(t),s=e.split("/");return i.host?t:(s.pop(),n=t.split("/"),n.forEach(function(e){".."===e?s.pop():o.push(e)}),r=s.concat(o),r.join("/"))},EPUBJS.core.uuid=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:7&r|8).toString(16)});return t},EPUBJS.core.insert=function(e,t,r){var n=EPUBJS.core.locationOf(e,t,r);return t.splice(n,0,e),n},EPUBJS.core.locationOf=function(e,t,r,n,o){var i,s=n||0,a=o||t.length,c=parseInt(s+(a-s)/2);return r||(r=function(e,t){return e>t?1:t>e?-1:(e=t)?0:void 0}),0>=a-s?c:(i=r(t[c],e),a-s===1?i>0?c:c+1:0===i?c:-1===i?EPUBJS.core.locationOf(e,t,r,c,a):EPUBJS.core.locationOf(e,t,r,s,c))},EPUBJS.core.indexOfSorted=function(e,t,r,n,o){var i,s=n||0,a=o||t.length,c=parseInt(s+(a-s)/2);return r||(r=function(e,t){return e>t?1:t>e?-1:(e=t)?0:void 0}),0>=a-s?-1:(i=r(t[c],e),a-s===1?0===i?c:-1:0===i?c:-1===i?EPUBJS.core.indexOfSorted(e,t,r,c,a):EPUBJS.core.indexOfSorted(e,t,r,s,c))},EPUBJS.core.queue=function(e){var t=[],r=e,n=function(e,r,n){return t.push({funcName:e,args:r,context:n}),t},o=function(){var e;t.length&&(e=t.shift(),r[e.funcName].apply(e.context||r,e.args))},i=function(){for(;t.length;)o()},s=function(){t=[]},a=function(){return t.length};return{enqueue:n,dequeue:o,flush:i,clear:s,length:a}},EPUBJS.core.getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':EPUBJS.core.getElementTreeXPath(e)},EPUBJS.core.getElementTreeXPath=function(e){var t,r,n,o,i=[],s="http://www.w3.org/1999/xhtml"===e.ownerDocument.documentElement.getAttribute("xmlns");for(e.nodeType===Node.TEXT_NODE&&(t=EPUBJS.core.indexOfTextNode(e)+1,i.push("text()["+t+"]"),e=e.parentNode);e&&1==e.nodeType;e=e.parentNode){t=0;for(var a=e.previousSibling;a;a=a.previousSibling)a.nodeType!=Node.DOCUMENT_TYPE_NODE&&a.nodeName==e.nodeName&&++t;r=e.nodeName.toLowerCase(),n=s?"xhtml:"+r:r,o=t?"["+(t+1)+"]":"",i.splice(0,0,n+o)}return i.length?"./"+i.join("/"):null},EPUBJS.core.nsResolver=function(e){var t={xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"};return t[e]||null},EPUBJS.core.cleanStringForXpath=function(e){var t=e.match(/[^'"]+|['"]/g);return t=t.map(function(e){return"'"===e?'"\'"':'"'===e?"'\"'":"'"+e+"'"}),"concat('',"+t.join(",")+")"},EPUBJS.core.indexOfTextNode=function(e){for(var t,r=e.parentNode,n=r.childNodes,o=-1,i=0;i<n.length&&(t=n[i],t.nodeType===Node.TEXT_NODE&&o++,t!=e);i++);return o},EPUBJS.core.defaults=function(e){for(var t=1,r=arguments.length;r>t;t++){var n=arguments[t];for(var o in n)void 0===e[o]&&(e[o]=n[o])}return e},EPUBJS.core.extend=function(e){var t=[].slice.call(arguments,1);return t.forEach(function(t){t&&Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}),e},EPUBJS.core.clone=function(e){return EPUBJS.core.isArray(e)?e.slice():EPUBJS.core.extend({},e)},EPUBJS.core.isElement=function(e){return!(!e||1!=e.nodeType)},EPUBJS.core.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},EPUBJS.core.isString=function(e){return"string"==typeof e||e instanceof String},EPUBJS.core.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},EPUBJS.core.values=function(e){var t,r,n,o=-1;if(!e)return[];for(t=Object.keys(e),r=t.length,n=Array(r);++o<r;)n[o]=e[t[o]];return n},EPUBJS.EpubCFI=function(e){return e?this.parse(e):void 0},EPUBJS.EpubCFI.prototype.generateChapterComponent=function(e,t,r){var n=parseInt(t),o=e+1,i="/"+o+"/";return i+=2*(n+1),r&&(i+="["+r+"]"),i},EPUBJS.EpubCFI.prototype.generatePathComponent=function(e){var t=[];return e.forEach(function(e){var r="";r+=2*(e.index+1),e.id&&(r+="["+e.id+"]"),t.push(r)}),t.join("/")},EPUBJS.EpubCFI.prototype.generateCfiFromElement=function(e,t){var r=this.pathTo(e),n=this.generatePathComponent(r);return n.length?"epubcfi("+t+"!"+n+"/1:0)":"epubcfi("+t+"!/4/)"},EPUBJS.EpubCFI.prototype.pathTo=function(e){for(var t,r=[];e&&null!==e.parentNode&&9!=e.parentNode.nodeType;)t=e.parentNode.children,r.unshift({id:e.id,tagName:e.tagName,index:t?Array.prototype.indexOf.call(t,e):0}),e=e.parentNode;return r},EPUBJS.EpubCFI.prototype.getChapterComponent=function(e){var t=e.split("!");return t[0]},EPUBJS.EpubCFI.prototype.getPathComponent=function(e){var t=e.split("!"),r=t[1]?t[1].split(":"):"";return r[0]},EPUBJS.EpubCFI.prototype.getCharecterOffsetComponent=function(e){var t=e.split(":");return t[1]||""},EPUBJS.EpubCFI.prototype.parse=function(e){var t,r,n,o,i,s,a,c,h,p={},u=function(e){var t,r,n,o;return t="element",r=parseInt(e)/2-1,n=e.match(/\[(.*)\]/),n&&n[1]&&(o=n[1]),{type:t,index:r,id:o||!1}};return"string"!=typeof e?{spinePos:-1}:(p.str=e,0===e.indexOf("epubcfi(")&&")"===e[e.length-1]&&(e=e.slice(8,e.length-1)),r=this.getChapterComponent(e),n=this.getPathComponent(e)||"",o=this.getCharecterOffsetComponent(e),r&&(t=r.split("/")[2]||"")?(p.spinePos=parseInt(t)/2-1||0,s=t.match(/\[(.*)\]/),p.spineId=!!s&&s[1],-1!=n.indexOf(",")&&console.warn("CFI Ranges are not supported"),a=n.split("/"),c=a.pop(),p.steps=[],a.forEach(function(e){var t;e&&(t=u(e),p.steps.push(t))}),h=parseInt(c),isNaN(h)||p.steps.push(h%2===0?u(c):{type:"text",index:(h-1)/2}),i=o.match(/\[(.*)\]/),i&&i[1]?(p.characterOffset=parseInt(o.split("[")[0]),p.textLocationAssertion=i[1]):p.characterOffset=parseInt(o),p):{spinePos:-1})},EPUBJS.EpubCFI.prototype.addMarker=function(e,t,r){var n,o,i,s,a=t||document,c=r||this.createMarker(a);return"string"==typeof e&&(e=this.parse(e)),o=e.steps[e.steps.length-1],-1!==e.spinePos&&(!!(n=this.findParent(e,a))&&(o&&"text"===o.type?(i=n.childNodes[o.index],e.characterOffset?(s=i.splitText(e.characterOffset),c.classList.add("EPUBJS-CFI-SPLIT"),n.insertBefore(c,s)):n.insertBefore(c,i)):n.insertBefore(c,n.firstChild),c))},EPUBJS.EpubCFI.prototype.createMarker=function(e){var t=e||document,r=t.createElement("span");return r.id="EPUBJS-CFI-MARKER:"+EPUBJS.core.uuid(),r.classList.add("EPUBJS-CFI-MARKER"),r},EPUBJS.EpubCFI.prototype.removeMarker=function(e,t){e.classList.contains("EPUBJS-CFI-SPLIT")?(nextSib=e.nextSibling,prevSib=e.previousSibling,nextSib&&prevSib&&3===nextSib.nodeType&&3===prevSib.nodeType&&(prevSib.textContent+=nextSib.textContent,e.parentNode.removeChild(nextSib)),e.parentNode.removeChild(e)):e.classList.contains("EPUBJS-CFI-MARKER")&&e.parentNode.removeChild(e)},EPUBJS.EpubCFI.prototype.findParent=function(e,t){var r,n,o,i=t||document,s=i.getElementsByTagName("html")[0],a=Array.prototype.slice.call(s.children);if("string"==typeof e&&(e=this.parse(e)),n=e.steps.slice(0),!n.length)return i.getElementsByTagName("body")[0];for(;n&&n.length>0;){if(r=n.shift(),"text"===r.type?(o=s.childNodes[r.index],s=o.parentNode||s):s=r.id?i.getElementById(r.id):a[r.index],!s||"undefined"==typeof s)return console.error("No Element For",r,e.str),!1;a=Array.prototype.slice.call(s.children)}return s},EPUBJS.EpubCFI.prototype.compare=function(e,t){if("string"==typeof e&&(e=new EPUBJS.EpubCFI(e)),"string"==typeof t&&(t=new EPUBJS.EpubCFI(t)),e.spinePos>t.spinePos)return 1;if(e.spinePos<t.spinePos)return-1;for(var r=0;r<e.steps.length;r++){if(!t.steps[r])return 1;if(e.steps[r].index>t.steps[r].index)return 1;if(e.steps[r].index<t.steps[r].index)return-1}return e.steps.length<t.steps.length?-1:e.characterOffset>t.characterOffset?1:e.characterOffset<t.characterOffset?-1:0},EPUBJS.EpubCFI.prototype.generateCfiFromHref=function(e,t){var r,n,o=EPUBJS.core.uri(e),i=o.path,s=o.fragment,a=t.spineIndexByURL[i],c=new RSVP.defer,h=new EPUBJS.EpubCFI;return"undefined"!=typeof a&&(n=t.spine[a],r=t.loadXml(n.url),r.then(function(e){var t,r=e.getElementById(s);t=h.generateCfiFromElement(r,n.cfiBase),c.resolve(t)})),c.promise},EPUBJS.EpubCFI.prototype.generateCfiFromTextNode=function(e,t,r){var n=e.parentNode,o=this.pathTo(n),i=this.generatePathComponent(o),s=1+2*Array.prototype.indexOf.call(n.childNodes,e);return"epubcfi("+r+"!"+i+"/"+s+":"+(t||0)+")"},EPUBJS.EpubCFI.prototype.generateCfiFromRangeAnchor=function(e,t){var r=e.anchorNode,n=e.anchorOffset;return this.generateCfiFromTextNode(r,n,t)},EPUBJS.EpubCFI.prototype.generateCfiFromRange=function(e,t){var r,n,o,i,s,a,c,h,p,u,l,d;if(r=e.startContainer,3===r.nodeType)n=r.parentNode,a=1+2*EPUBJS.core.indexOfTextNode(r),o=this.pathTo(n);else{if(e.collapsed)return this.generateCfiFromElement(r,t);o=this.pathTo(r)}return i=this.generatePathComponent(o),s=e.startOffset,e.collapsed?"epubcfi("+t+"!"+i+"/"+a+":"+s+")":(c=e.endContainer,3===c.nodeType?(h=c.parentNode,d=1+2*EPUBJS.core.indexOfTextNode(c),p=this.pathTo(h)):p=this.pathTo(c),u=this.generatePathComponent(p),l=e.endOffset,u=u.replace(i,""),u.length&&(u+="/"),"epubcfi("+t+"!"+i+"/"+a+":"+s+","+u+d+":"+l+")")},EPUBJS.EpubCFI.prototype.generateXpathFromSteps=function(e){var t=[".","*"];return e.forEach(function(e){var r=e.index+1;t.push(e.id?"*[position()="+r+" and @id='"+e.id+"']":"text"===e.type?"text()["+r+"]":"*["+r+"]")}),t.join("/")},EPUBJS.EpubCFI.prototype.generateQueryFromSteps=function(e){var t=["html"];return e.forEach(function(e){var r=e.index+1;e.id?t.push("#"+e.id):"text"===e.type||t.push("*:nth-child("+r+")")}),t.join(">")},EPUBJS.EpubCFI.prototype.generateRangeFromCfi=function(e,t){var r,n,o,i,s,a,c=t||document,h=c.createRange();return"string"==typeof e&&(e=this.parse(e)),-1!==e.spinePos&&(r=e.steps[e.steps.length-1],"undefined"!=typeof document.evaluate?(n=this.generateXpathFromSteps(e.steps),o=c.evaluate(n,c,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):(s=this.generateQueryFromSteps(e.steps),a=c.querySelector(s),a&&"text"==r.type&&(o=a.childNodes[r.index])),o?(o&&e.characterOffset>=0?(i=o.length,e.characterOffset<i?(h.setStart(o,e.characterOffset),h.setEnd(o,i)):(console.debug("offset greater than length:",e.characterOffset,i),h.setStart(o,i-1),h.setEnd(o,i))):o&&h.selectNode(o),h):null)},EPUBJS.EpubCFI.prototype.isCfiString=function(e){return"string"==typeof e&&0===e.indexOf("epubcfi(")},EPUBJS.Events=function(e,t){return this.events={},this.el=t?t:document.createElement("div"),e.createEvent=this.createEvent,e.tell=this.tell,e.listen=this.listen,e.deafen=this.deafen,e.listenUntil=this.listenUntil,this},EPUBJS.Events.prototype.createEvent=function(e){var t=new CustomEvent(e);return this.events[e]=t,t},EPUBJS.Events.prototype.tell=function(e,t){var r;this.events[e]?r=this.events[e]:(console.warn("No event:",e,"defined yet, creating."),r=this.createEvent(e)),t&&(r.msg=t),this.el.dispatchEvent(r)},EPUBJS.Events.prototype.listen=function(e,t,r){return this.events[e]?void(r?this.el.addEventListener(e,t.bind(r),!1):this.el.addEventListener(e,t,!1)):(console.warn("No event:",e,"defined yet, creating."),void this.createEvent(e))},EPUBJS.Events.prototype.deafen=function(e,t){this.el.removeEventListener(e,t,!1)},EPUBJS.Events.prototype.listenUntil=function(e,t,r,n){function o(){this.deafen(e,r),this.deafen(t,o)}this.listen(e,r,n),this.listen(t,o,this)},EPUBJS.hooks={},EPUBJS.Hooks=function(){function e(){}return e.prototype.getHooks=function(){var e;this.hooks={},Array.prototype.slice.call(arguments).forEach(function(e){this.hooks[e]=[]},this);for(var t in this.hooks)e=EPUBJS.core.values(EPUBJS.hooks[t]),e.forEach(function(e){this.registerHook(t,e)},this)},e.prototype.registerHook=function(e,t,r){"undefined"!=typeof this.hooks[e]?"function"==typeof t?r?this.hooks[e].unshift(t):this.hooks[e].push(t):Array.isArray(t)&&t.forEach(function(t){r?this.hooks[e].unshift(t):this.hooks[e].push(t)},this):(this.hooks[e]=[t],"function"==typeof t?this.hooks[e]=[t]:Array.isArray(t)&&(this.hooks[e]=[],t.forEach(function(t){this.hooks[e].push(t)},this)))},e.prototype.removeHook=function(e,t){var r;"undefined"!=typeof this.hooks[e]&&("function"==typeof t?(r=this.hooks[e].indexOf(t),r>-1&&this.hooks[e].splice(r,1)):Array.isArray(t)&&t.forEach(function(t){r=this.hooks[e].indexOf(t),r>-1&&this.hooks[e].splice(r,1)},this))},e.prototype.triggerHooks=function(e,t,r){function n(){i--,0>=i&&t&&t()}var o,i;return"undefined"!=typeof this.hooks[e]&&(o=this.hooks[e],i=o.length,0===i&&t&&t(),void o.forEach(function(e){e(n,r)}))},{register:function(e){if(void 0===EPUBJS.hooks[e]&&(EPUBJS.hooks[e]={}),"object"!=typeof EPUBJS.hooks[e])throw"Already registered: "+e;return EPUBJS.hooks[e]},mixin:function(t){for(var r in e.prototype)t[r]=e.prototype[r]}}}(),EPUBJS.Layout=EPUBJS.Layout||{},EPUBJS.Layout.Reflowable=function(){this.documentElement=null,this.spreadWidth=null},EPUBJS.Layout.Reflowable.prototype.format=function(e,t,r,n){var o=EPUBJS.core.prefixed("columnAxis"),i=EPUBJS.core.prefixed("columnGap"),s=EPUBJS.core.prefixed("columnWidth"),a=EPUBJS.core.prefixed("columnFill"),c=Math.floor(t),h=Math.floor(c/8),p=n>=0?n:h%2===0?h:h-1;return this.documentElement=e,this.spreadWidth=c+p,e.style.overflow="hidden",e.style.width=c+"px",e.style.height=r+"px",e.style[o]="horizontal",e.style[a]="auto",e.style[s]=c+"px",e.style[i]=p+"px",this.colWidth=c,this.gap=p,{pageWidth:this.spreadWidth,pageHeight:r}},EPUBJS.Layout.Reflowable.prototype.calculatePages=function(){var e,t;return this.documentElement.style.width="auto",e=this.documentElement.scrollWidth,t=Math.ceil(e/this.spreadWidth),{displayedPages:t,pageCount:t}},EPUBJS.Layout.ReflowableSpreads=function(){this.documentElement=null,this.spreadWidth=null},EPUBJS.Layout.ReflowableSpreads.prototype.format=function(e,t,r,n){var o=EPUBJS.core.prefixed("columnAxis"),i=EPUBJS.core.prefixed("columnGap"),s=EPUBJS.core.prefixed("columnWidth"),a=EPUBJS.core.prefixed("columnFill"),c=2,h=Math.floor(t),p=h%2===0?h:h-1,u=Math.floor(p/8),l=n>=0?n:u%2===0?u:u-1,d=Math.floor((p-l)/c);return this.documentElement=e,this.spreadWidth=(d+l)*c,e.style.overflow="hidden",e.style.width=p+"px",e.style.height=r+"px",e.style[o]="horizontal",e.style[a]="auto",e.style[i]=l+"px",e.style[s]=d+"px",this.colWidth=d,this.gap=l,{pageWidth:this.spreadWidth,pageHeight:r}},EPUBJS.Layout.ReflowableSpreads.prototype.calculatePages=function(){var e=this.documentElement.scrollWidth,t=Math.ceil(e/this.spreadWidth);return this.documentElement.style.width=t*this.spreadWidth-this.gap+"px",{displayedPages:t,pageCount:2*t}},EPUBJS.Layout.Fixed=function(){this.documentElement=null},EPUBJS.Layout.Fixed.prototype.format=function(e){var t,r,n,o,i=EPUBJS.core.prefixed("columnWidth"),s=e.querySelector("[name=viewport]");return this.documentElement=e,s&&s.hasAttribute("content")&&(t=s.getAttribute("content"),r=t.split(","),r[0]&&(n=r[0].replace("width=","")),r[1]&&(o=r[1].replace("height=",""))),e.style.width=n+"px"||"auto",e.style.height=o+"px"||"auto",e.style[i]="auto",e.style.overflow="auto",this.colWidth=n,this.gap=0,{pageWidth:n,pageHeight:o}},EPUBJS.Layout.Fixed.prototype.calculatePages=function(){return{displayedPages:1,pageCount:1}},EPUBJS.Locations=function(e,t,r){this.spine=e,this.store=t,this.credentials=r,this.epubcfi=new EPUBJS.EpubCFI,this._locations=[],this.total=0,this["break"]=150,this._current=0},EPUBJS.Locations.prototype.generate=function(e){var t,r=new RSVP.defer,n=-1,o=this.spine.length,i=function(e){var t,r=n+1,s=e||new RSVP.defer;return r>=o?s.resolve():(n=r,t=new EPUBJS.Chapter(this.spine[n],this.store,this.credentials),this.process(t).then(function(){setTimeout(function(){i(s)},1)})),s.promise}.bind(this);return"number"==typeof e&&(this["break"]=e),t=i().then(function(){this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),r.resolve(this._locations)}.bind(this)),r.promise},EPUBJS.Locations.prototype.process=function(e){return e.load().then(function(t){var r,n,o,i=t,s=i.documentElement.querySelector("body"),a=0;this.sprint(s,function(t){var s,c=t.length,h=0;for(0===a&&(r=i.createRange(),r.setStart(t,0)),s=this["break"]-a,s>c&&(a+=c,h=c);c>h;)a=this["break"],h+=this["break"],h>=c?a=c-(h-this["break"]):(r.setEnd(t,h),o=e.cfiFromRange(r),this._locations.push(o),a=0,h+=1,r=i.createRange(),r.setStart(t,h));n=t}.bind(this)),r&&(r.setEnd(n,n.length),o=e.cfiFromRange(r),this._locations.push(o),a=0)}.bind(this))},EPUBJS.Locations.prototype.sprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);r=n.nextNode();)t(r)},EPUBJS.Locations.prototype.locationFromCfi=function(e){return 0===this._locations.length?-1:EPUBJS.core.locationOf(e,this._locations,this.epubcfi.compare)},EPUBJS.Locations.prototype.percentageFromCfi=function(e){var t=this.locationFromCfi(e);return this.percentageFromLocation(t)},EPUBJS.Locations.prototype.percentageFromLocation=function(e){return e&&this.total?e/this.total:0},EPUBJS.Locations.prototype.cfiFromLocation=function(e){var t=-1;return"number"!=typeof e&&(e=parseInt(e)),e>=0&&e<this._locations.length&&(t=this._locations[e]),t},EPUBJS.Locations.prototype.cfiFromPercentage=function(e){var t=e>1?e/100:e,r=Math.ceil(this.total*t);return this.cfiFromLocation(r)},EPUBJS.Locations.prototype.load=function(e){return this._locations=JSON.parse(e),this.total=this._locations.length-1,this._locations},EPUBJS.Locations.prototype.save=function(){return JSON.stringify(this._locations)},EPUBJS.Locations.prototype.getCurrent=function(){return this._current},EPUBJS.Locations.prototype.setCurrent=function(e){var t;if("string"==typeof e)this._currentCfi=e;else{if("number"!=typeof e)return;this._current=e}0!==this._locations.length&&("string"==typeof e?(t=this.locationFromCfi(e),this._current=t):t=e,this.trigger("changed",{percentage:this.percentageFromLocation(t)}))},Object.defineProperty(EPUBJS.Locations.prototype,"currentLocation",{get:function(){return this._current},set:function(e){this.setCurrent(e)}}),RSVP.EventTarget.mixin(EPUBJS.Locations.prototype),EPUBJS.Pagination=function(e){this.pages=[],this.locations=[],this.epubcfi=new EPUBJS.EpubCFI,e&&e.length&&this.process(e)},EPUBJS.Pagination.prototype.process=function(e){e.forEach(function(e){this.pages.push(e.page),this.locations.push(e.cfi)},this),this.pageList=e,this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage},EPUBJS.Pagination.prototype.pageFromCfi=function(e){var t=-1;if(0===this.locations.length)return-1;var r=EPUBJS.core.indexOfSorted(e,this.locations,this.epubcfi.compare);return-1!=r&&r<this.pages.length-1?t=this.pages[r]:(r=EPUBJS.core.locationOf(e,this.locations,this.epubcfi.compare),t=r-1>=0?this.pages[r-1]:this.pages[0],void 0!==t||(t=-1)),t},EPUBJS.Pagination.prototype.cfiFromPage=function(e){var t=-1;"number"!=typeof e&&(e=parseInt(e));var r=this.pages.indexOf(e);return-1!=r&&(t=this.locations[r]),t},EPUBJS.Pagination.prototype.pageFromPercentage=function(e){var t=Math.round(this.totalPages*e);return t},EPUBJS.Pagination.prototype.percentageFromPage=function(e){var t=(e-this.firstPage)/this.totalPages;return Math.round(1e3*t)/1e3},EPUBJS.Pagination.prototype.percentageFromCfi=function(e){var t=this.pageFromCfi(e),r=this.percentageFromPage(t);return r},EPUBJS.Parser=function(e){this.baseUrl=e||""},EPUBJS.Parser.prototype.container=function(e){var t,r,n,o;return e?(t=e.querySelector("rootfile"))?(r=t.getAttribute("full-path"),n=EPUBJS.core.uri(r).directory,o=e.xmlEncoding,{packagePath:r,basePath:n,encoding:o}):void console.error("No RootFile Found"):void console.error("Container File Not Found")},EPUBJS.Parser.prototype.identifier=function(e){var t;return e?(t=e.querySelector("metadata"),t?this.getElementText(t,"identifier"):void console.error("No Metadata Found")):void console.error("Package File Not Found")},EPUBJS.Parser.prototype.packageContents=function(e,t){var r,n,o,i,s,a,c,h,p,u,l,d=this;return t&&(this.baseUrl=t),e?(r=e.querySelector("metadata"))?(n=e.querySelector("manifest"))?(o=e.querySelector("spine"))?(i=d.manifest(n),s=d.findNavPath(n),a=d.findTocPath(n,o),c=d.findCoverPath(e),h=Array.prototype.indexOf.call(o.parentNode.childNodes,o),p=d.spine(o,i),u={},p.forEach(function(e){u[e.href]=e.index}),l=d.metadata(r),l.direction=o.getAttribute("page-progression-direction"),{metadata:l,spine:p,manifest:i,navPath:s,tocPath:a,coverPath:c,spineNodeIndex:h,spineIndexByURL:u}):void console.error("No Spine Found"):void console.error("No Manifest Found"):void console.error("No Metadata Found"):void console.error("Package File Not Found")},EPUBJS.Parser.prototype.findNavPath=function(e){var t=e.querySelector("item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']");return!!t&&t.getAttribute("href")},EPUBJS.Parser.prototype.findTocPath=function(e,t){var r,n=e.querySelector("item[media-type='application/x-dtbncx+xml']");return n||(r=t.getAttribute("toc"),r&&(n=e.querySelector("item[id='"+r+"']"))),!!n&&n.getAttribute("href")},EPUBJS.Parser.prototype.metadata=function(e){var t={},r=this;return t.bookTitle=r.getElementText(e,"title"),t.creator=r.getElementText(e,"creator"),t.description=r.getElementText(e,"description"),t.pubdate=r.getElementText(e,"date"),t.publisher=r.getElementText(e,"publisher"),t.identifier=r.getElementText(e,"identifier"),t.language=r.getElementText(e,"language"),t.rights=r.getElementText(e,"rights"),t.modified_date=r.querySelectorText(e,"meta[property='dcterms:modified']"),t.layout=r.querySelectorText(e,"meta[property='rendition:layout']"),t.orientation=r.querySelectorText(e,"meta[property='rendition:orientation']"),t.spread=r.querySelectorText(e,"meta[property='rendition:spread']"),t},EPUBJS.Parser.prototype.findCoverPath=function(e){var t=e.querySelector("package").getAttribute("version");if("2.0"===t){var r=e.querySelector('meta[name="cover"]');if(r){var n=r.getAttribute("content"),o=e.querySelector("item[id='"+n+"']");return!!o&&o.getAttribute("href")}return!1}var i=e.querySelector("item[properties='cover-image']");return!!i&&i.getAttribute("href")},EPUBJS.Parser.prototype.getElementText=function(e,t){var r,n=e.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",t);return n&&0!==n.length?(r=n[0],r.childNodes.length?r.childNodes[0].nodeValue:""):""},EPUBJS.Parser.prototype.querySelectorText=function(e,t){var r=e.querySelector(t);return r&&r.childNodes.length?r.childNodes[0].nodeValue:""},EPUBJS.Parser.prototype.manifest=function(e){var t=this.baseUrl,r={},n=e.querySelectorAll("item"),o=Array.prototype.slice.call(n);return o.forEach(function(e){var n=e.getAttribute("id"),o=e.getAttribute("href")||"",i=e.getAttribute("media-type")||"",s=e.getAttribute("properties")||"";r[n]={href:o,url:t+o,type:i,properties:s}}),r},EPUBJS.Parser.prototype.spine=function(e,t){var r=[],n=e.getElementsByTagName("itemref"),o=Array.prototype.slice.call(n),i=Array.prototype.indexOf.call(e.parentNode.childNodes,e),s=new EPUBJS.EpubCFI;
return o.forEach(function(e,n){var o=e.getAttribute("idref"),a=s.generateChapterComponent(i,n,o),c=e.getAttribute("properties")||"",h=c.length?c.split(" "):[],p=t[o].properties,u=p.length?p.split(" "):[],l={id:o,linear:e.getAttribute("linear")||"",properties:h,manifestProperties:u,href:t[o].href,url:t[o].url,index:n,cfiBase:a,cfi:"epubcfi("+a+")"};r.push(l)}),r},EPUBJS.Parser.prototype.querySelectorByType=function(e,t,r){var n=e.querySelector(t+'[*|type="'+r+'"]');if(null!==n&&0!==n.length)return n;n=e.querySelectorAll(t);for(var o=0;o<n.length;o++)if(n[o].getAttributeNS("http://www.idpf.org/2007/ops","type")===r)return n[o]},EPUBJS.Parser.prototype.nav=function(e,t,r){var n,o,i,s=this.querySelectorByType(e,"nav","toc"),a=s?s.querySelectorAll("ol li"):[],c=a.length,h={},p=[];if(!a||0===c)return p;for(n=0;c>n;++n)o=this.navItem(a[n],t,r),h[o.id]=o,o.parent?(i=h[o.parent],i.subitems.push(o)):p.push(o);return p},EPUBJS.Parser.prototype.navItem=function(e,t,r){var n,o=e.getAttribute("id")||!1,i=e.querySelector("a, span"),s=i.getAttribute("href")||"",a=i.textContent||"",c=s.split("#"),h=c[0],p=t[h],u=r[p],l=[],d=e.parentNode,f=u?u.cfi:"";return d&&"navPoint"===d.nodeName&&(n=d.getAttribute("id")),o||(p?(u=r[p],o=u.id,f=u.cfi):(o="epubjs-autogen-toc-id-"+EPUBJS.core.uuid(),e.setAttribute("id",o))),{id:o,href:s,label:a,spinePos:p,subitems:l,parent:n,cfi:f}},EPUBJS.Parser.prototype.toc=function(e,t,r){var n,o,i,s=e.querySelectorAll("navMap navPoint"),a=s.length,c={},h=[];if(!s||0===a)return h;for(n=0;a>n;++n)o=this.tocItem(s[n],t,r),c[o.id]=o,o.parent?(i=c[o.parent],i.subitems.push(o)):h.push(o);return h},EPUBJS.Parser.prototype.tocItem=function(e,t,r){var n,o=e.getAttribute("id")||!1,i=e.querySelector("content"),s=i.getAttribute("src"),a=e.querySelector("navLabel"),c=a.textContent?a.textContent:"",h=s.split("#"),p=h[0],u=t[p],l=r[u],d=[],f=e.parentNode,g=l?l.cfi:"";return f&&"navPoint"===f.nodeName&&(n=f.getAttribute("id")),o||(u?(l=r[u],o=l.id,g=l.cfi):(o="epubjs-autogen-toc-id-"+EPUBJS.core.uuid(),e.setAttribute("id",o))),{id:o,href:s,label:c,spinePos:u,subitems:d,parent:n,cfi:g}},EPUBJS.Parser.prototype.pageList=function(e,t,r){var n,o,i=this.querySelectorByType(e,"nav","page-list"),s=i?i.querySelectorAll("ol li"):[],a=s.length,c=[];if(!s||0===a)return c;for(n=0;a>n;++n)o=this.pageListItem(s[n],t,r),c.push(o);return c},EPUBJS.Parser.prototype.pageListItem=function(e){var t,r,n,o=(e.getAttribute("id")||!1,e.querySelector("a")),i=o.getAttribute("href")||"",s=o.textContent||"",a=parseInt(s),c=i.indexOf("epubcfi");return-1!=c?(t=i.split("#"),r=t[0],n=t.length>1&&t[1],{cfi:n,href:i,packageUrl:r,page:a}):{href:i,page:a}},EPUBJS.Render.Iframe=function(){this.iframe=null,this.document=null,this.window=null,this.docEl=null,this.bodyEl=null,this.leftPos=0,this.pageWidth=0},EPUBJS.Render.Iframe.prototype.create=function(){return this.iframe=document.createElement("iframe"),this.iframe.id="epubjs-iframe:"+EPUBJS.core.uuid(),this.iframe.scrolling="no",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.addEventListener("load",this.loaded.bind(this),!1),this.isMobile=navigator.userAgent.match(/(iPad|iPhone|iPod|Mobile|Android)/g),this.transform=EPUBJS.core.prefixed("transform"),this.iframe},EPUBJS.Render.Iframe.prototype.load=function(e){var t=this,r=new RSVP.defer;return this.window&&this.unload(),this.iframe.onload=function(){t.document=t.iframe.contentDocument,t.docEl=t.document.documentElement,t.headEl=t.document.head,t.bodyEl=t.document.body||t.document.querySelector("body"),t.window=t.iframe.contentWindow,t.window.addEventListener("resize",t.resized.bind(t),!1),t.leftPos=0,t.setLeft(0),t.bodyEl&&(t.bodyEl.style.margin="0"),"rtl"==t.direction&&"rtl"!=t.docEl.dir&&(t.docEl.dir="rtl",t.docEl.style.position="absolute",t.docEl.style.right="0"),r.resolve(t.docEl)},this.iframe.onerror=function(e){r.reject({message:"Error Loading Contents: "+e,stack:(new Error).stack})},this.document=this.iframe.contentDocument,this.document?(this.document.open(),this.document.write(e),this.document.close(),r.promise):(r.reject(new Error("No Document Available")),r)},EPUBJS.Render.Iframe.prototype.loaded=function(){var e,t,r=this.iframe.contentWindow.location.href;this.document=this.iframe.contentDocument,this.docEl=this.document.documentElement,this.headEl=this.document.head,this.bodyEl=this.document.body||this.document.querySelector("body"),this.window=this.iframe.contentWindow,"about:blank"!=r&&(e=this.iframe.contentDocument.querySelector("base"),t=e.getAttribute("href"),this.trigger("render:loaded",t))},EPUBJS.Render.Iframe.prototype.resize=function(e,t){this.iframe&&(this.iframe.height=t,isNaN(e)||e%2===0||(e+=1),this.iframe.width=e,this.width=this.iframe.getBoundingClientRect().width||e,this.height=this.iframe.getBoundingClientRect().height||t)},EPUBJS.Render.Iframe.prototype.resized=function(){this.width=this.iframe.getBoundingClientRect().width,this.height=this.iframe.getBoundingClientRect().height},EPUBJS.Render.Iframe.prototype.totalWidth=function(){return this.docEl.scrollWidth},EPUBJS.Render.Iframe.prototype.totalHeight=function(){return this.docEl.scrollHeight},EPUBJS.Render.Iframe.prototype.setPageDimensions=function(e,t){this.pageWidth=e,this.pageHeight=t},EPUBJS.Render.Iframe.prototype.setDirection=function(e){this.direction=e,this.docEl&&"rtl"==this.docEl.dir&&(this.docEl.dir="rtl",this.docEl.style.position="static",this.docEl.style.right="auto")},EPUBJS.Render.Iframe.prototype.setLeft=function(e){this.isMobile?this.docEl.style[this.transform]="translate("+-e+"px, 0)":this.document.defaultView.scrollTo(e,0)},EPUBJS.Render.Iframe.prototype.setStyle=function(e,t,r){r&&(e=EPUBJS.core.prefixed(e)),this.bodyEl&&(this.bodyEl.style[e]=t)},EPUBJS.Render.Iframe.prototype.removeStyle=function(e){this.bodyEl&&(this.bodyEl.style[e]="")},EPUBJS.Render.Iframe.prototype.addHeadTag=function(e,t,r){var n=r||this.document,o=n.createElement(e),i=n.head;for(var s in t)o.setAttribute(s,t[s]);i&&i.insertBefore(o,i.firstChild)},EPUBJS.Render.Iframe.prototype.page=function(e){this.leftPos=this.pageWidth*(e-1),"rtl"===this.direction&&(this.leftPos=-1*this.leftPos),this.setLeft(this.leftPos)},EPUBJS.Render.Iframe.prototype.getPageNumberByElement=function(e){var t,r;if(e)return t=this.leftPos+e.getBoundingClientRect().left,r=Math.floor(t/this.pageWidth)+1},EPUBJS.Render.Iframe.prototype.getPageNumberByRect=function(e){var t,r;return t=this.leftPos+e.left,r=Math.floor(t/this.pageWidth)+1},EPUBJS.Render.Iframe.prototype.getBaseElement=function(){return this.bodyEl},EPUBJS.Render.Iframe.prototype.getDocumentElement=function(){return this.docEl},EPUBJS.Render.Iframe.prototype.isElementVisible=function(e){var t,r;return!!(e&&"function"==typeof e.getBoundingClientRect&&(t=e.getBoundingClientRect(),r=t.left,0!==t.width&&0!==t.height&&r>=0&&r<this.pageWidth))},EPUBJS.Render.Iframe.prototype.scroll=function(e){this.iframe.scrolling=e?"yes":"no"},EPUBJS.Render.Iframe.prototype.unload=function(){this.window.removeEventListener("resize",this.resized),this.window.location.reload()},RSVP.EventTarget.mixin(EPUBJS.Render.Iframe.prototype),EPUBJS.Renderer=function(e,t){this.listenedEvents=["keydown","keyup","keypressed","mouseup","mousedown","click"],this.upEvent="mouseup",this.downEvent="mousedown","ontouchstart"in document.documentElement&&(this.listenedEvents.push("touchstart","touchend"),this.upEvent="touchend",this.downEvent="touchstart"),e&&"undefined"!=typeof EPUBJS.Render[e]?this.render=new EPUBJS.Render[e]:console.error("Not a Valid Rendering Method"),this.render.on("render:loaded",this.loaded.bind(this)),this.caches={},this.epubcfi=new EPUBJS.EpubCFI,this.spreads=!0,this.isForcedSingle=!1,this.resized=this.onResized.bind(this),this.layoutSettings={},this.hidden=t||!1,EPUBJS.Hooks.mixin(this),this.getHooks("beforeChapterDisplay"),this._q=EPUBJS.core.queue(this),this._moving=!1},EPUBJS.Renderer.prototype.Events=["renderer:keydown","renderer:keyup","renderer:keypressed","renderer:mouseup","renderer:mousedown","renderer:click","renderer:touchstart","renderer:touchend","renderer:selected","renderer:chapterUnload","renderer:chapterUnloaded","renderer:chapterDisplayed","renderer:locationChanged","renderer:visibleLocationChanged","renderer:resized","renderer:spreads"],EPUBJS.Renderer.prototype.initialize=function(e,t,r){this.container=e,this.element=this.render.create(),this.initWidth=t,this.initHeight=r,this.width=t||this.container.clientWidth,this.height=r||this.container.clientHeight,this.container.appendChild(this.element),t&&r?this.render.resize(this.width,this.height):this.render.resize("100%","100%"),document.addEventListener("orientationchange",this.onResized)},EPUBJS.Renderer.prototype.displayChapter=function(e,t){return this._moving?void console.error("Rendering In Progress"):(this._moving=!0,e.render().then(function(r){return this.currentChapter&&(this.trigger("renderer:chapterUnload"),this.currentChapter.unload(),this.render.window&&this.render.window.removeEventListener("resize",this.resized),this.removeEventListeners(),this.removeSelectionListeners(),this.trigger("renderer:chapterUnloaded"),this.contents=null,this.doc=null,this.pageMap=null),this.currentChapter=e,this.chapterPos=1,this.currentChapterCfiBase=e.cfiBase,this.layoutSettings=this.reconcileLayoutSettings(t,e.properties),this.load(r,e.href)}.bind(this)))},EPUBJS.Renderer.prototype.load=function(e,t){var r=new RSVP.defer;return this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod],this.visible(!1),this.render.load(e,t).then(function(e){this.afterLoad(e),this.beforeDisplay(function(){this.afterDisplay(),this.visible(!0),r.resolve(this)}.bind(this))}.bind(this)),r.promise},EPUBJS.Renderer.prototype.afterLoad=function(e){this.currentChapter.setDocument(this.render.document),this.contents=e,this.doc=this.render.document,this.formated=this.layout.format(e,this.render.width,this.render.height,this.gap),this.render.setPageDimensions(this.formated.pageWidth,this.formated.pageHeight),this.initWidth||this.initHeight||this.render.window.addEventListener("resize",this.resized,!1),this.addEventListeners(),this.addSelectionListeners()},EPUBJS.Renderer.prototype.afterDisplay=function(){var e=this.layout.calculatePages(),t=this.currentChapter,r=this._q.length();this._moving=!1,this.updatePages(e),this.visibleRangeCfi=this.getVisibleRangeCfi(),this.currentLocationCfi=this.visibleRangeCfi.start,0===r&&(this.trigger("renderer:locationChanged",this.currentLocationCfi),this.trigger("renderer:visibleRangeChanged",this.visibleRangeCfi)),t.cfi=this.currentLocationCfi,this.trigger("renderer:chapterDisplayed",t)},EPUBJS.Renderer.prototype.loaded=function(e){this.trigger("render:loaded",e)},EPUBJS.Renderer.prototype.reconcileLayoutSettings=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return t.forEach(function(e){var t,n,o=e.replace("rendition:",""),i=o.indexOf("-");-1!=i&&(t=o.slice(0,i),n=o.slice(i+1),r[t]=n)}),r},EPUBJS.Renderer.prototype.determineLayout=function(e){var t=this.determineSpreads(this.minSpreadWidth),r=t?"ReflowableSpreads":"Reflowable",n=!1;return"pre-paginated"===e.layout&&(r="Fixed",n=!0,t=!1),"reflowable"===e.layout&&"none"===e.spread&&(r="Reflowable",n=!1,t=!1),"reflowable"===e.layout&&"both"===e.spread&&(r="ReflowableSpreads",n=!1,t=!0),this.spreads=t,this.render.scroll(n),this.trigger("renderer:spreads",t),r},EPUBJS.Renderer.prototype.beforeDisplay=function(e){this.triggerHooks("beforeChapterDisplay",e,this)},EPUBJS.Renderer.prototype.updatePages=function(){this.pageMap=this.mapPage(),this.displayedPages=this.spreads?Math.ceil(this.pageMap.length/2):this.pageMap.length,this.currentChapter.pages=this.pageMap.length,this._q.flush()},EPUBJS.Renderer.prototype.reformat=function(){var e,t,r=this;this.contents&&(t=this.determineSpreads(this.minSpreadWidth),t!=this.spreads&&(this.spreads=t,this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod]),this.chapterPos=1,this.render.page(this.chapterPos),r.formated=r.layout.format(r.render.docEl,r.render.width,r.render.height,r.gap),r.render.setPageDimensions(r.formated.pageWidth,r.formated.pageHeight),e=r.layout.calculatePages(),r.updatePages(e),r.currentLocationCfi&&r.gotoCfi(r.currentLocationCfi))},EPUBJS.Renderer.prototype.visible=function(e){return"undefined"==typeof e?this.element.style.visibility:void(e!==!0||this.hidden?e===!1&&(this.element.style.visibility="hidden"):this.element.style.visibility="visible")},EPUBJS.Renderer.prototype.remove=function(){this.render.window&&(this.render.unload(),this.render.window.removeEventListener("resize",this.resized),this.removeEventListeners(),this.removeSelectionListeners()),this.container.removeChild(this.element)},EPUBJS.Renderer.prototype.applyStyles=function(e){for(var t in e)this.render.setStyle(t,e[t])},EPUBJS.Renderer.prototype.setStyle=function(e,t,r){this.render.setStyle(e,t,r)},EPUBJS.Renderer.prototype.removeStyle=function(e){this.render.removeStyle(e)},EPUBJS.Renderer.prototype.applyHeadTags=function(e){for(var t in e)this.render.addHeadTag(t,e[t])},EPUBJS.Renderer.prototype.page=function(e){return this.pageMap?e>=1&&e<=this.displayedPages&&(this.chapterPos=e,this.render.page(e),this.visibleRangeCfi=this.getVisibleRangeCfi(),this.currentLocationCfi=this.visibleRangeCfi.start,this.trigger("renderer:locationChanged",this.currentLocationCfi),this.trigger("renderer:visibleRangeChanged",this.visibleRangeCfi),!0):(console.warn("pageMap not set, queuing"),this._q.enqueue("page",arguments),!0)},EPUBJS.Renderer.prototype.nextPage=function(){return this.page(this.chapterPos+1)},EPUBJS.Renderer.prototype.prevPage=function(){return this.page(this.chapterPos-1)},EPUBJS.Renderer.prototype.pageByElement=function(e){var t;e&&(t=this.render.getPageNumberByElement(e),this.page(t))},EPUBJS.Renderer.prototype.lastPage=function(){return this._moving?this._q.enqueue("lastPage",arguments):void this.page(this.displayedPages)},EPUBJS.Renderer.prototype.firstPage=function(){return this._moving?this._q.enqueue("firstPage",arguments):void this.page(1)},EPUBJS.Renderer.prototype.section=function(e){var t=this.doc.getElementById(e);t&&this.pageByElement(t)},EPUBJS.Renderer.prototype.firstElementisTextNode=function(e){var t=e.childNodes,r=t.length;return!!(r&&t[0]&&3===t[0].nodeType&&t[0].textContent.trim().length)},EPUBJS.Renderer.prototype.isGoodNode=function(e){var t=["audio","canvas","embed","iframe","img","math","object","svg","video"];return-1!==t.indexOf(e.tagName.toLowerCase())||this.firstElementisTextNode(e)},EPUBJS.Renderer.prototype.walk=function(e,t,r){for(var n,o,i,s,a=e,c=[a],h=1e4,p=0;!n&&c.length;){if(e=c.shift(),this.containsPoint(e,t,r)&&this.isGoodNode(e)&&(n=e),!n&&e&&e.childElementCount>0){if(o=e.children,!o||!o.length)return n;i=o.length?o.length:0;for(var u=i-1;u>=0;u--)o[u]!=s&&c.unshift(o[u])}if(!n&&0===c.length&&a&&null!==a.parentNode&&(c.push(a.parentNode),s=a,a=a.parentNode),p++,p>h){console.error("ENDLESS LOOP");break}}return n},EPUBJS.Renderer.prototype.containsPoint=function(e,t){var r;return!!(e&&"function"==typeof e.getBoundingClientRect&&(r=e.getBoundingClientRect(),0!==r.width&&0!==r.height&&r.left>=t&&t<=r.left+r.width))},EPUBJS.Renderer.prototype.textSprint=function(e,t){var r,n,o=function(e){return/^\s*$/.test(e.data)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT};try{for(r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:o},!1);n=r.nextNode();)t(n)}catch(i){for(r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,o,!1);n=r.nextNode();)t(n)}},EPUBJS.Renderer.prototype.sprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);r=n.nextNode();)t(r)},EPUBJS.Renderer.prototype.mapPage=function(){var e,t,r,n,o,i,s,a,c=this,h=[],p=this.render.getBaseElement(),u=1,l=this.layout.colWidth+this.layout.gap,d=this.formated.pageWidth*(this.chapterPos-1),f=l*u-d,g=0,m=function(t){var r,o,i;if(t.nodeType==Node.TEXT_NODE){if(o=document.createRange(),o.selectNodeContents(t),r=o.getBoundingClientRect(),!r||0===r.width&&0===r.height)return;r.left>g&&(i=y(t)),r.right>g&&(i=y(t)),n=t,i&&(e=null)}},y=function(o){var i,s=c.splitTextNodeIntoWordsRanges(o);return s.forEach(function(o){var s=o.getBoundingClientRect();!s||0===s.width&&0===s.height||(s.left+s.width<f?h[u-1]||(o.collapse(!0),r=c.currentChapter.cfiFromRange(o),i=h.push({start:r,end:null})):(!e&&n&&(t=c.splitTextNodeIntoWordsRanges(n),e=t[t.length-1]),e&&(e.collapse(!1),r=c.currentChapter.cfiFromRange(e),h[h.length-1].end=r),o.collapse(!0),r=c.currentChapter.cfiFromRange(o),i=h.push({start:r,end:null}),u+=1,f=l*u-d,g=f),e=o)}),i},v=this.render.getDocumentElement(),E=v.dir;return"rtl"==E&&(v.dir="ltr",v.style.position="static"),this.textSprint(p,m),"rtl"==E&&(v.dir=E,v.style.left="auto",v.style.right="0"),!e&&n&&(t=c.splitTextNodeIntoWordsRanges(n),e=t[t.length-1]),e&&(e.collapse(!1),r=c.currentChapter.cfiFromRange(e),h[h.length-1].end=r),h.length||(o=this.doc.createRange(),o.selectNodeContents(p),o.collapse(!0),s=c.currentChapter.cfiFromRange(o),i=this.doc.createRange(),i.selectNodeContents(p),i.collapse(!1),a=c.currentChapter.cfiFromRange(i),h.push({start:s,end:a})),e=null,t=void 0,o=null,i=null,p=null,h},EPUBJS.Renderer.prototype.indexOfBreakableChar=function(e,t){var r="- \t\r\n\b\f";t||(t=0);for(var n=t;n<e.length;n++)if(-1!=r.indexOf(e.charAt(n)))return n;return-1},EPUBJS.Renderer.prototype.splitTextNodeIntoWordsRanges=function(e){var t,r=[],n=e.textContent.trim(),o=this.indexOfBreakableChar(n);if(-1===o)return t=this.doc.createRange(),t.selectNodeContents(e),[t];for(t=this.doc.createRange(),t.setStart(e,0),t.setEnd(e,o),r.push(t),t=this.doc.createRange(),t.setStart(e,o+1);-1!=o;)o=this.indexOfBreakableChar(n,o+1),o>0&&(t&&(t.setEnd(e,o),r.push(t)),t=this.doc.createRange(),t.setStart(e,o+1));return t&&(t.setEnd(e,n.length),r.push(t)),r},EPUBJS.Renderer.prototype.rangePosition=function(e){var t,r;return r=e.getClientRects(),r.length?t=r[0]:null},EPUBJS.Renderer.prototype.getPageCfi=function(){var e=2*this.chapterPos-1;return this.pageMap[e].start},EPUBJS.Renderer.prototype.getRange=function(e,t,r){var n,o=this.doc.createRange();return r=!0,"undefined"==typeof document.caretPositionFromPoint||r?"undefined"==typeof document.caretRangeFromPoint||r?(this.visibileEl=this.findElementAfter(e,t),o.setStart(this.visibileEl,1)):o=this.doc.caretRangeFromPoint(e,t):(n=this.doc.caretPositionFromPoint(e,t),o.setStart(n.offsetNode,n.offset)),o},EPUBJS.Renderer.prototype.pagesInCurrentChapter=function(){var e,t;return this.pageMap?(t=this.pageMap.length,e=this.spreads?Math.ceil(t/2):t):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.currentRenderedPage=function(){var e;return this.pageMap?e=this.spreads&&this.pageMap.length>1?2*this.chapterPos:this.chapterPos:(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.getRenderedPagesLeft=function(){var e,t,r;return this.pageMap?(t=this.pageMap.length,e=this.spreads?2*this.chapterPos:this.chapterPos,r=t-e):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.getVisibleRangeCfi=function(){var e,t,r;return this.pageMap?(this.spreads?(e=2*this.chapterPos,t=this.pageMap[e-2],r=t,this.pageMap.length>1&&this.pageMap.length>e-1&&(r=this.pageMap[e-1])):(e=this.chapterPos,t=this.pageMap[e-1],r=t),t||(console.warn("page range miss:",e,this.pageMap),t=this.pageMap[this.pageMap.length-1],r=t),{start:t.start,end:r.end}):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.gotoCfi=function(e){var t,r,n;if(this._moving)return this._q.enqueue("gotoCfi",arguments);if(EPUBJS.core.isString(e)&&(e=this.epubcfi.parse(e)),"undefined"==typeof document.evaluate)r=this.epubcfi.addMarker(e,this.doc),r&&(t=this.render.getPageNumberByElement(r),this.epubcfi.removeMarker(r,this.doc),this.page(t));else if(n=this.epubcfi.generateRangeFromCfi(e,this.doc)){var o=n.getBoundingClientRect();t=o?this.render.getPageNumberByRect(o):1,this.page(t),this.currentLocationCfi=e.str}else this.page(1)},EPUBJS.Renderer.prototype.findFirstVisible=function(e){var t,r=e||this.render.getBaseElement();return t=this.walk(r,0,0),t?t:e},EPUBJS.Renderer.prototype.findElementAfter=function(e,t,r){var n,o=r||this.render.getBaseElement();return n=this.walk(o,e,t),n?n:o},EPUBJS.Renderer.prototype.resize=function(e,t,r){this.width=e,this.height=t,r!==!1&&this.render.resize(this.width,this.height),this.contents&&this.reformat(),this.trigger("renderer:resized",{width:this.width,height:this.height})},EPUBJS.Renderer.prototype.onResized=function(){var e=this.container.clientWidth,t=this.container.clientHeight;this.resize(e,t,!1)},EPUBJS.Renderer.prototype.addEventListeners=function(){this.render.document&&this.listenedEvents.forEach(function(e){this.render.document.addEventListener(e,this.triggerEvent.bind(this),!1)},this)},EPUBJS.Renderer.prototype.removeEventListeners=function(){this.render.document&&this.listenedEvents.forEach(function(e){this.render.document.removeEventListener(e,this.triggerEvent,!1)},this)},EPUBJS.Renderer.prototype.triggerEvent=function(e){this.trigger("renderer:"+e.type,e)},EPUBJS.Renderer.prototype.addSelectionListeners=function(){this.render.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)},EPUBJS.Renderer.prototype.removeSelectionListeners=function(){this.render.document&&this.doc.removeEventListener("selectionchange",this.onSelectionChange,!1)},EPUBJS.Renderer.prototype.onSelectionChange=function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){this.selectedRange=this.render.window.getSelection(),this.trigger("renderer:selected",this.selectedRange)}.bind(this),500)},EPUBJS.Renderer.prototype.setMinSpreadWidth=function(e){this.minSpreadWidth=e,this.spreads=this.determineSpreads(e)},EPUBJS.Renderer.prototype.determineSpreads=function(e){return!(this.isForcedSingle||!e||this.width<e)},EPUBJS.Renderer.prototype.forceSingle=function(e){this.isForcedSingle=!!e},EPUBJS.Renderer.prototype.setGap=function(e){this.gap=e},EPUBJS.Renderer.prototype.setDirection=function(e){this.direction=e,this.render.setDirection(this.direction)},EPUBJS.Renderer.prototype.replace=function(e,t,r,n){var o=this.contents.querySelectorAll(e),i=Array.prototype.slice.call(o),s=i.length;return 0===s?void r(!1):void i.forEach(function(e){var o=!1,i=function(e,t){o===!1&&(s--,n&&n(e,t,s),0>=s&&r&&r(!0),o=!0)};t(e,i)}.bind(this))},RSVP.EventTarget.mixin(EPUBJS.Renderer.prototype);var EPUBJS=EPUBJS||{};EPUBJS.replace={},EPUBJS.replace.hrefs=function(e,t){var r=this,n=function(e,n){var o,i,s,a,c,h=e.getAttribute("href"),p=h.search("://");-1!=p?e.setAttribute("target","_blank"):(s=t.render.docEl.querySelector("base"),c=s.getAttribute("href"),a=EPUBJS.core.uri(c),o=a.directory,i=o?"file"===a.protocol?EPUBJS.core.resolveUrl(a.base,h):EPUBJS.core.resolveUrl(o,h):h,e.onclick=function(){return r["goto"](i),!1}),n()};t.replace("a[href]",n,e)},EPUBJS.replace.head=function(e,t){t.replaceWithStored("link[href]","href",EPUBJS.replace.links,e)},EPUBJS.replace.resources=function(e,t){t.replaceWithStored("[src]","src",EPUBJS.replace.srcs,e)},EPUBJS.replace.svg=function(e,t){t.replaceWithStored("svg image","xlink:href",function(e,t,r){e.getUrl(t).then(r)},e)},EPUBJS.replace.srcs=function(e,t,r){e.getUrl(t).then(r)},EPUBJS.replace.links=function(e,t,r,n){"stylesheet"===n.getAttribute("rel")?EPUBJS.replace.stylesheets(e,t).then(function(e,t){r(e,t)},function(){r(null)}):e.getUrl(t).then(r,function(){r(null)})},EPUBJS.replace.stylesheets=function(e,t){var r=new RSVP.defer;if(e)return e.getText(t).then(function(n){EPUBJS.replace.cssUrls(e,t,n).then(function(e){var t=window.URL||window.webkitURL||window.mozURL,n=new Blob([e],{type:"text/css"}),o=t.createObjectURL(n);r.resolve(o)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},EPUBJS.replace.cssUrls=function(e,t,r){var n=new RSVP.defer,o=[],i=r.match(/url\(\'?\"?((?!data:)[^\'|^\"^\)]*)\'?\"?\)/g);if(e)return i?(i.forEach(function(i){var s=EPUBJS.core.resolveUrl(t,i.replace(/url\(|[|\)|\'|\"]|\?.*$/g,"")),a=e.getUrl(s).then(function(e){r=r.replace(i,'url("'+e+'")')},function(e){n.reject(e)});o.push(a)}),RSVP.all(o).then(function(){n.resolve(r)}),n.promise):(n.resolve(r),n.promise)},EPUBJS.Storage=function(e){this.checkRequirements(),this.urlCache={},this.withCredentials=e,this.URL=window.URL||window.webkitURL||window.mozURL,this.offline=!1},EPUBJS.Storage.prototype.checkRequirements=function(){"undefined"==typeof localforage&&console.error("localForage library not loaded")},EPUBJS.Storage.prototype.put=function(e){var t=new RSVP.defer,r=e.length,n=0,o=function(t){var i,s,a=t||new RSVP.defer;return n>=r?a.resolve():(i=e[n].url,s=window.encodeURIComponent(i),EPUBJS.core.request(i,"binary").then(function(e){return localforage.setItem(s,e)}).then(function(){n++,setTimeout(function(){o(a)},1)})),a.promise}.bind(this);return Array.isArray(e)||(e=[e]),o().then(function(){t.resolve()}.bind(this)),t.promise},EPUBJS.Storage.prototype.token=function(e,t){var r=window.encodeURIComponent(e);return localforage.setItem(r,t).then(function(e){return null!==e})},EPUBJS.Storage.prototype.isStored=function(e){var t=window.encodeURIComponent(e);return localforage.getItem(t).then(function(e){return null!==e})},EPUBJS.Storage.prototype.getText=function(e){var t=window.encodeURIComponent(e);return EPUBJS.core.request(e,"arraybuffer",this.withCredentials).then(function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,e),e}.bind(this)).then(function(t){var r=new RSVP.defer,n=EPUBJS.core.getMimeType(e),o=new Blob([t],{type:n}),i=new FileReader;return i.addEventListener("loadend",function(){r.resolve(i.result)}),i.readAsText(o,n),r.promise})["catch"](function(){var r=new RSVP.defer,n=localforage.getItem(t);return this.offline||(this.offline=!0,this.trigger("offline",!0)),n?(n.then(function(t){var n=EPUBJS.core.getMimeType(e),o=new Blob([t],{type:n}),i=new FileReader;i.addEventListener("loadend",function(){r.resolve(i.result)}),i.readAsText(o,n)}),r.promise):(r.reject({message:"File not found in the storage: "+e,stack:(new Error).stack}),r.promise)}.bind(this))},EPUBJS.Storage.prototype.getUrl=function(e){var t=window.encodeURIComponent(e);return EPUBJS.core.request(e,"arraybuffer",this.withCredentials).then(function(r){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,r),e}.bind(this))["catch"](function(){var r,n,o=new RSVP.defer,i=window.URL||window.webkitURL||window.mozURL;return this.offline||(this.offline=!0,this.trigger("offline",!0)),t in this.urlCache?(o.resolve(this.urlCache[t]),o.promise):(r=localforage.getItem(t))?(r.then(function(r){var s=new Blob([r],{type:EPUBJS.core.getMimeType(e)});n=i.createObjectURL(s),o.resolve(n),this.urlCache[t]=n}.bind(this)),o.promise):(o.reject({message:"File not found in the storage: "+e,stack:(new Error).stack}),o.promise)}.bind(this))},EPUBJS.Storage.prototype.getXml=function(e){var t=window.encodeURIComponent(e);return EPUBJS.core.request(e,"arraybuffer",this.withCredentials).then(function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,e),e}.bind(this)).then(function(t){var r=new RSVP.defer,n=EPUBJS.core.getMimeType(e),o=new Blob([t],{type:n}),i=new FileReader;return i.addEventListener("loadend",function(){var e=new DOMParser,t=e.parseFromString(i.result,"text/xml");r.resolve(t)}),i.readAsText(o,n),r.promise})["catch"](function(){var r=new RSVP.defer,n=localforage.getItem(t);return this.offline||(this.offline=!0,this.trigger("offline",!0)),n?(n.then(function(t){var n=EPUBJS.core.getMimeType(e),o=new Blob([t],{type:n}),i=new FileReader;i.addEventListener("loadend",function(){var e=new DOMParser,t=e.parseFromString(i.result,"text/xml");r.resolve(t)}),i.readAsText(o,n)}),r.promise):(r.reject({message:"File not found in the storage: "+e,stack:(new Error).stack}),r.promise)}.bind(this))},EPUBJS.Storage.prototype.revokeUrl=function(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)},EPUBJS.Storage.prototype.failed=function(e){console.error(e)},RSVP.EventTarget.mixin(EPUBJS.Storage.prototype),EPUBJS.Unarchiver=function(){this.checkRequirements(),this.urlCache={}},EPUBJS.Unarchiver.prototype.checkRequirements=function(){"undefined"==typeof JSZip&&console.error("JSZip lib not loaded")},EPUBJS.Unarchiver.prototype.open=function(e){if(e instanceof ArrayBuffer){this.zip=new JSZip(e);var t=new RSVP.defer;return t.resolve(),t.promise}return EPUBJS.core.request(e,"binary").then(function(e){this.zip=new JSZip(e)}.bind(this))},EPUBJS.Unarchiver.prototype.getXml=function(e,t){var r=window.decodeURIComponent(e);return this.getText(r,t).then(function(t){var r=new DOMParser,n=EPUBJS.core.getMimeType(e);return r.parseFromString(t,n)})},EPUBJS.Unarchiver.prototype.getUrl=function(e){var t,r,n=this,o=new RSVP.defer,i=window.decodeURIComponent(e),s=this.zip.file(i),a=window.URL||window.webkitURL||window.mozURL;return s?e in this.urlCache?(o.resolve(this.urlCache[e]),o.promise):(r=new Blob([s.asUint8Array()],{type:EPUBJS.core.getMimeType(s.name)}),t=a.createObjectURL(r),o.resolve(t),n.urlCache[e]=t,o.promise):(o.reject({message:"File not found in the epub: "+e,stack:(new Error).stack}),o.promise)},EPUBJS.Unarchiver.prototype.getText=function(e){var t,r=new RSVP.defer,n=window.decodeURIComponent(e),o=this.zip.file(n);return o?(t=o.asText(),r.resolve(t),r.promise):(r.reject({message:"File not found in the epub: "+e,stack:(new Error).stack}),r.promise)},EPUBJS.Unarchiver.prototype.revokeUrl=function(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)},EPUBJS.Unarchiver.prototype.failed=function(e){console.error(e)},EPUBJS.Unarchiver.prototype.afterSaved=function(){this.callback()},EPUBJS.Unarchiver.prototype.toStorage=function(e){function t(){i--,0===i&&o.afterSaved()}var r=0,n=20,o=this,i=e.length;e.forEach(function(e){setTimeout(function(e){o.saveEntryFileToStorage(e,t)},r,e),r+=n}),console.log("time",r)},function(){var e={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},text:{"cache-manifest":["manifest","appcache"],
calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcard":"vcf",sgml:["sgml","sgm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},t=function(){var t,r,n,o,i={};for(t in e)if(e.hasOwnProperty(t))for(r in e[t])if(e[t].hasOwnProperty(r))if(n=e[t][r],"string"==typeof n)i[n]=t+"/"+r;else for(o=0;o<n.length;o++)i[n[o]]=t+"/"+r;return i}();EPUBJS.core.getMimeType=function(e){var r="text/plain";return e&&t[e.split(".").pop().toLowerCase()]||r}}();