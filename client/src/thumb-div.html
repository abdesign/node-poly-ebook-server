<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-styles/color.html">

<link rel="import" href="long-tap-behavior.html">


<dom-module id="thumb-div">
    <template>
        <style is="custom-style">
            :host {
                display: block;
                box-sizing: border-box;
            }
            :root {
                --primary-text-color: #dae2f7;

                --photo-content-detail: {
                    background: transparent;
                };
                --thumb-link-color: #dae2f7;
            }
            .thumbContent {
                @apply(--layout);
                position: relative;
                margin: 0px;
            }

            .thumbContent:hover .detail {
                opacity: 1;
            }

            .thumbContent .label {
                background-color: transparent;
                color: var(--primary-text-color);
                position: absolute;
                left: 0;
                top: 0;
                overflow: hidden;
            }

            .thumbContent > iron-image {
                @apply(--layout-flex);
            }

            .thumbContent > .detail {
                @apply(--photo-content-detail);
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                font-size: 18px;
                font-weight: bold;
                padding: 0;
                opacity: 0;
                transition: opacity 0.1s;
            }

            paper-fab.blue, a.blue {
                color: var(--thumb-link-color);
                cursor: pointer;

                --paper-fab-background: var(--paper-light-blue-500);
                --paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
            }
        </style>

        <div class="thumbContainer">
            <div class="thumbContent" style$="{{thumbCss}}" tabindex$="[[tabIndex]]" title="[[index]]) [[_computeTitle(file)]]">

                <div class="label">[[_computeLabel(file)]]</div>

                <iron-image sizing="cover" src="[[_computeImgUrl(file)]]"></iron-image>

                <div class="detail horizontal layout">
                    <a href="../[[file]]" target="_blank">
                        <paper-fab mini icon="cloud-download"></paper-fab>
                    </a>
                    <paper-fab mini hidden$="[[!deleteVisible]]" icon="delete" class="blue deleteIcon" on-tap="deleteFile"></paper-fab>
                    <paper-fab mini hidden$="[[!copyVisible]]" icon="content-copy" class="blue copyIcon" on-tap="copyFile"></paper-fab>
                    <paper-fab mini hidden$="[[!sendLinkVisible]]" icon="send" class="blue" on-tap="sendLink"></paper-fab>
                    <paper-fab mini hidden$="[[!sendAttachmentVisible]]" icon="attachment" class="blue copyIcon" on-tap="sendAttachment"></paper-fab>
                </div>
            </div>
        </div>

    </template>


    <script>
        HTMLImports.whenReady(function () {
            Polymer({
                is: 'thumb-div',
                behaviors: [LongTapBehavior],
                properties: {
                    deleteVisible: {
                        type: Boolean,
                        value: false
                    },
                    copyVisible: {
                        type: Boolean,
                        value: false
                    },
                    sendLinkVisible: {
                        type: Boolean,
                        value: false
                    },
                    sendAttachmentVisible: {
                        type: Boolean,
                        value: false
                    },
                    thumbCss: {
                        type: String,
                        value: ''
                    }
                },
                observers: [],

                deleteFile: function (event, detail, sender) {
                    this.fire('thumb-div-action', {file: this.file, method: 'delete'});
                },
                copyFile: function (event, detail, sender) {
                    this.fire('thumb-div-action', {file: this.file, method: 'copy'});
                },
                sendAttachment: function (event, detail, sender) {
                    this.fire('thumb-div-action', {file: this.file, method: 'sendattachment'});
                },
                sendLink: function (event, detail, sender) {
                    this.fire('thumb-div-action', {file: this.file, method: 'sendlink'});
                },


                _computeTitle: function (file) {
                    return file.substring(1 + file.lastIndexOf('/'));
                },
                _computeLabel: function (file) {
                    var i = Math.max(file.lastIndexOf('\\'), file.lastIndexOf('/')) + 1;
                    return file.substr(i);
                },
                _computeImgUrl: function (file) {
                    var img = file.replace('file/', 'img/');
                    img = img.substr(0, img.lastIndexOf('.')) + '.jpg';
                    return img;
                },

                // Element Lifecycle:
                ready: function() {
                },
                attached: function() {
                    var self = this;
                    Polymer.RenderStatus.afterNextRender(this, function () {
                        this.addEventListener('longtap', function (event, detail, sender) {
                            //console.info('inner : self.file ', self.file);
                            // TODO
                        })
                    });
                },
                detached: function() {
                }
            });
        });
    </script>


</dom-module>